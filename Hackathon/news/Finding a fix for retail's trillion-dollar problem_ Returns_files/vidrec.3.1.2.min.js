!function(){function e(t,n,o){function i(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(r)return r(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){return i(t[a][1][e]||e)},c,c.exports,e,t,n,o)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<o.length;a++)i(o[a]);return i}return e}()({1:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("@vilynx/frontend-core/config/coreConfig"),r=e("@vilynx/frontend-core/Logger"),a=o(r);e("@vilynx/frontend-core/polyfills/promises");var s=e("@vilynx/frontend-core/VersionChecker"),l=o(s),u=e("./dagda/config/privateConfig"),c=e("./dagda/config/publicConfig"),d=e("./dagda/enums"),f=e("./dagda/events"),g=e("./dagda/events/LoadEvent"),v=o(g),h=e("./dagda/events/RecoEvent"),p=o(h),m=e("./dagdaSession"),y=e("./DagdaTrackEventListener"),_=o(y),b=e("./EventListenersName"),w=e("./SPANavigationListener"),E=o(w),S=function(){function e(e,t){this._isActive=!0,this._logger=new a.default("[DAGDA-"+u.privateConfig.pluginVersion+"]"),this._dagdaSession=new m.DagdaSession,t&&(c.publicConfig.publickey=t.publicKey,c.publicConfig.passiveTracking=t.passiveTracking,c.publicConfig.spaNavigation=t.spaNavigation,i.coreConfig.logLevel=t.logLevel||i.coreConfig.logLevel),this._configureSPANavigationListener();var n=new v.default(e),o=this._getSessionEventsArray(e,t);o.push(n),window.vilynx=window.vilynx||{},window.vilynx.dagda=window.vilynx.dagda||{};var r=!1;if(this._defineProperties(),this._initializeCustomEventsListeners(),window.vilynx.dagda.version){r=!0;if(l.default.checkVersion(window.vilynx.dagda.version,u.privateConfig.pluginVersion)===s.VersionIs.greater)return this._logger.info("A previous Dagda, with newer version was on the page."),void this._newDagadVersionInstantiatedListener(null);var g=new Event("new_dagda_version");window.vilynx.dagda.version=u.privateConfig.pluginVersion,this._logger.info("Instantianing a new version of Dagda"),addEventListener("old_dagda_events",this._oldDagdaEventsListener.bind(this)),this._logger.info("Sending new_dagda_version event to old dagda"),dispatchEvent(g)}else{this._logger.info("There was not a previous Dagda version. Setting it and sending HitEvent.");var h=new f.HitEvent({eventType:d.HitEvents.pageLoad,passiveTracking:c.publicConfig.passiveTracking,publicKey:c.publicConfig.publickey});addEventListener("old_dagda_events",this._oldDagdaEventsListener.bind(this)),o.push(h),window.vilynx.dagda.version=u.privateConfig.pluginVersion}addEventListener("new_dagda_version",this._newDagadVersionInstantiatedListener.bind(this)),this._addCustomEventsListeners(),this._logger.info("Dagda class initialized"),window.vilynx.dagda.t&&!r||(window.vilynx.dagda.mediaTrack=this.mediaTrack,window.vilynx.dagda.textTrack=this.textTrack,window.vilynx.dagda.t=+new Date,c.publicConfig.godMode&&(window.vilynx.dagda.galleryTrack=this.galleryTrack,window.vilynx.dagda.recoTrack=this.recoTrack)),this._clearCache()}return e.prototype._getSessionEventsArray=function(e,t){return this._useInitialEvents(e,t)?this._dagdaSession.initEvents:this._dagdaSession.events},e.prototype._useInitialEvents=function(e,t){return t&&null!==t.useInitialEvents?t.useInitialEvents:e.pluginName!==u.privateConfig.pluginName},e.prototype._configureSPANavigationListener=function(){c.publicConfig.spaNavigation&&(this._SPANavigationListener=new E.default(this._dagdaSession),this._SPANavigationListener.startListening())},e.prototype._oldDagdaEventsListener=function(e){this._logger.info("Receiving events from older Dagda version."),this._dagdaSession.addEventsFromOldDagda(e.detail)},e.prototype._newDagadVersionInstantiatedListener=function(e){this._logger.info("Received instantiaton message from a newer Dagda. Unloading current one."),this._isActive=!1;var t=this._dagdaSession.getAllPendingEvents(),n=JSON.stringify(t),o=new CustomEvent("old_dagda_events",{detail:{events:n}});this._logger.debug("Sending "+t.length+" events to new Dagda"),this._removeCustomEventsListeners(),dispatchEvent(o),this._dagdaSession.removeUnloadListeners(),this._dagdaSession.stopSendingEvents(),this._dagdaSession.clearEventsArray(),removeEventListener("new_dagda_version",this._newDagadVersionInstantiatedListener)},e.prototype._initializeCustomEventsListeners=function(){this._customEventslisteners=[new _.default(b.EventListenersName.galleryEvent,this._trackGalleryEventHandler.bind(this)),new _.default(b.EventListenersName.recoEvent,this._trackRecoEventHandler.bind(this)),new _.default(b.EventListenersName.mediaEvent,this._trackMediaEventHandler.bind(this)),new _.default(b.EventListenersName.textEvent,this._trackTextEventHandler.bind(this))]},e.prototype._addCustomEventsListeners=function(){this._logger.info("Adding listeners for dagda events"),this._customEventslisteners.forEach(function(e){e.activate()})},e.prototype._removeCustomEventsListeners=function(){this._logger.info("Removing listeners for dagda events"),this._customEventslisteners.forEach(function(e){e.deactivate()})},e.prototype._trackGalleryEventHandler=function(e){this._logger.info("Received GalleryEvent on a CustomEvent"),this.galleryTrack(e.detail.eventInterface)},e.prototype._trackRecoEventHandler=function(e){this._logger.info("Received RecoEvent on a CustomEvent"),this.recoTrack(e.detail.eventInterface)},e.prototype._trackMediaEventHandler=function(e){this._logger.info("Received MediaEvent on a CustomEvent"),this.mediaTrack(e.detail.eventInterface)},e.prototype._trackTextEventHandler=function(e){this._logger.info("Received TextEvent on a CustomEvent"),this.textTrack(e.detail.eventInterface)},e.prototype._defineProperties=function(){var e=this;this.mediaTrack=function(t){if(e._isActive){e._logger.debug("Current version of Dagda is active, adding MediaEvent to DagdaSession");var n=new f.MediaEvent(t);0===c.publicConfig.sendDelay?n.send():e._dagdaSession.push(n)}else e._broadcastEvent(b.EventListenersName.mediaEvent,t)},this.textTrack=function(t){if(e._isActive){e._logger.debug("Current version of Dagda is active, adding TextEvent to DagdaSession");var n=new f.TextEvent(t);e._logger.info("New Text Event created",t,n),0===c.publicConfig.sendDelay?n.send():e._dagdaSession.push(n)}else e._broadcastEvent(b.EventListenersName.textEvent,t)},this.galleryTrack=function(t){if(e._isActive){e._logger.debug("Current version of Dagda is active, adding GalleryEvent to DagdaSession");var n=new f.GalleryEvent(t);e._logger.info("New Gallery event created",t,n),0===c.publicConfig.sendDelay?n.send():e._dagdaSession.push(n)}else e._broadcastEvent(b.EventListenersName.galleryEvent,t)},this.recoTrack=function(t){if(e._isActive){e._logger.debug("Current version of Dagda is active, adding recoEvent to DagdaSession");var n=new p.default(t);e._logger.info("New Text Event created",t,n),0===c.publicConfig.sendDelay?n.send():e._dagdaSession.push(n)}else e._broadcastEvent(b.EventListenersName.recoEvent,t)}},e.prototype._broadcastEvent=function(e,t){this._logger.debug("Broadcasting event to "+e+".");var n=new CustomEvent(e,{detail:{eventInterface:t}});dispatchEvent(n)},e.prototype._clearCache=function(){var e=this,t=window.vilynx.dagda.chM||[],n=window.vilynx.dagda.chT||[];t.forEach(function(t){try{var n=new f.MediaEvent(t);e._logger.info("New Media Event created from cache",n),e._dagdaSession.push(n)}catch(n){e._logger.error("The cached event "+t+" is not a valid mediaEvent",n)}}),t=[],n.forEach(function(t){try{var n=new f.TextEvent(t);e._logger.info("New Text Event created from cache",n),e._dagdaSession.push(n)}catch(n){e._logger.error("The cached event "+t+" is not a valid textEvent",n)}}),n=[],0===c.publicConfig.sendDelay&&this._dagdaSession.sendEvents()},e}();n.default=S},{"./DagdaTrackEventListener":5,"./EventListenersName":6,"./SPANavigationListener":8,"./dagda/config/privateConfig":10,"./dagda/config/publicConfig":11,"./dagda/enums":14,"./dagda/events":23,"./dagda/events/LoadEvent":19,"./dagda/events/RecoEvent":21,"./dagdaSession":24,"@vilynx/frontend-core/Logger":25,"@vilynx/frontend-core/VersionChecker":27,"@vilynx/frontend-core/config/coreConfig":29,"@vilynx/frontend-core/polyfills/promises":33}],2:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("@vilynx/frontend-core/Logger"),r=o(i),a=e("@vilynx/frontend-core/utils"),s=e("./dagda/beacon/beacon"),l=o(s),u=e("./dagda/config/privateConfig"),c=e("./dagda/config/publicConfig"),d=e("./DagdaMeta"),f=o(d),g=function(){function e(e,t){this.groupLength=0,this._logger=new r.default("[DAGDA_EV_Group-"+u.privateConfig.pluginVersion+"]"),this.events=e,this.groupLength=this.events.length,this.creationTime=+new Date,this._guid=(0,a.generateRandomHex)(6),e.forEach(function(e){return e.sending()}),this._logger.info("New group created",this),this._meta_=t||this._defaultMeta()}return e.prototype.toJSON=function(){var e={};return this.events.forEach(function(t){try{e[t.eventCategory].push(t)}catch(n){e[t.eventCategory]=[t]}}),{_meta_:this._meta_,events:this.events}},e.prototype.sendGroup=function(){var e=btoa(JSON.stringify(this));return this._logger.info("Sending new event group",this.toJSON()),l.default.send(e)},e.prototype._defaultMeta=function(){return new f.default(this._guid,navigator.userAgent,u.privateConfig.uuid,this.groupLength,c.publicConfig.publickey,window.screen.availHeight+"x"+window.screen.availWidth)},e}();n.default=g},{"./DagdaMeta":4,"./dagda/beacon/beacon":9,"./dagda/config/privateConfig":10,"./dagda/config/publicConfig":11,"@vilynx/frontend-core/Logger":25,"@vilynx/frontend-core/utils":35}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e){}return e}();n.default=o},{}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t,n,o,i,r){this.GUID=e,this.UA=t,this.UUID=n,this.group_length=o,this.screen_size=r}return e}();n.default=o},{}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){this._eventName=e,this._eventHandler=t}return e.prototype.activate=function(){addEventListener(this._eventName,this._eventHandler)},e.prototype.deactivate=function(){removeEventListener(this._eventName,this._eventHandler)},e}();n.default=o},{}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=n.EventListenersName=void 0;!function(e){e.galleryEvent="dgd_track_gallery_event",e.recoEvent="dgd_track_reco_event",e.mediaEvent="dgd_track_media_event",e.textEvent="dgd_track_text_event"}(o||(n.EventListenersName=o={}))},{}],7:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("@vilynx/frontend-core/enums/storage"),r=e("@vilynx/frontend-core/localstorage"),a=e("@vilynx/frontend-core/Logger"),s=o(a),l=e("@vilynx/frontend-core/Pythonizer"),u=o(l),c=e("./dagda/config/privateConfig"),d=e("./dagda/events"),f=e("./DagdaEventGroup"),g=o(f),v=function(){function e(){this._logger=new s.default("[EventsStorage-"+c.privateConfig.pluginVersion+"]")}return e.prototype.storeEvents=function(e){if(e.length){var t=new g.default(e);r.ls.set("dgd_unsent",JSON.stringify(t),i.StorageFormat.base64)}},e.prototype.restoreEvents=function(){var e=this;return new Promise(function(t,n){var o=r.ls.get("dgd_unsent",i.StorageFormat.base64),a=[];if(o){var s=JSON.parse(o).events;s&&(a=s.map(function(t){var o;try{o=e.rawToEvent(t)}catch(o){e._logger.error("Exception parsing event",t,o),n()}return o}).filter(function(e){return null!==e}))}t(a)})},e.prototype.clearUnsent=function(){r.ls.remove("dgd_unsent")},e.prototype.rawToEvent=function(e){var t,n;switch(e.category){case"hit_event":t={eventId:e._evId,eventTime:e.event_time,eventType:u.default.toCamel(e.event_type),originUrl:e.origin_url,passiveTracking:e.passive_tracking,publicKey:e.public_key,url:e.url},n=new d.HitEvent(t);break;case"load_event":t={eventId:e._evId,eventTime:e.event_time,originUrl:e.origin_url,pluginName:e.plugin_name,pluginVersion:e.plugin_version,publicKey:e.public_key,url:e.url},n=new d.LoadEvent(t);break;case"text_event":t={currentTime:e.current_time,elementId:e.element_id,eventId:e._evId,eventTime:e.event_time,eventType:u.default.toCamel(e.event_type),originUrl:e.origin_url,publicKey:e.public_key,scrollPercentage:e.scroll_percentage,url:e.url},n=new d.TextEvent(t);break;case"reco_event":t={actionId:e.action_id,elemHash:e.elem_hash,eventId:e._evId,eventTime:e.event_time,eventType:u.default.toCamel(e.event_type),originUrl:e.origin_url,publicKey:e.public_key,url:e.url},n=new d.RecoEvent(t);break;case"gallery_event":t={actionId:e.action_id,currentTime:e.current_time,eventId:e._evId,eventTime:e.event_time,eventType:u.default.toCamel(e.event_type),isRedirect:e.is_redirect,originUrl:e.origin_url,passiveTracking:e.passive_tracking,previewHash:e.preview_hash,publicKey:e.public_key,resolution:e.resolution,url:e.url},n=new d.GalleryEvent(t);break;case"media_event":t={currentTime:e.current_time,elementId:e.element_id,eventId:e._evId,eventTime:e.event_time,eventType:u.default.toCamel(e.event_type),originUrl:e.origin_url,publicKey:e.public_key,url:e.url},n=new d.MediaEvent(t);break;default:return this._logger.error("Raw event can't be parsed.",e),null}return n.checkHasAllPropertiesOf(e),n},e}();n.default=v},{"./DagdaEventGroup":2,"./dagda/config/privateConfig":10,"./dagda/events":23,"@vilynx/frontend-core/Logger":25,"@vilynx/frontend-core/Pythonizer":26,"@vilynx/frontend-core/enums/storage":31,"@vilynx/frontend-core/localstorage":32}],8:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("@vilynx/frontend-core/Logger"),r=o(i),a=e("./dagda/config/publicConfig"),s=e("./dagda/enums"),l=e("./dagda/events/HitEvent"),u=o(l),c=function(){function e(e){this._logger=new r.default("[SPA_LISTENER]"),this._locationChangeListenerInterval=null,this._dagdaSession=e}return e.prototype.startListening=function(){var e=this;this._previousLocation=this._getCleanedUrl(),this._locationChangeListenerInterval=window.setInterval(function(){var t=e._getCleanedUrl();if(t!==e._previousLocation){e._logger.info("Location changed from "+e._previousLocation+" to "+window.location.href);var n=new u.default({eventType:s.HitEvents.spaNavigation,passiveTracking:a.publicConfig.passiveTracking});e._dagdaSession.push(n),e._previousLocation=t}},a.publicConfig.spaNavigationInterval)},e.prototype.stopListening=function(){window.clearInterval(this._locationChangeListenerInterval),this._locationChangeListenerInterval=null},e.prototype._getCleanedUrl=function(){return window.location.protocol+"//"+window.location.hostname+window.location.pathname},e}();n.default=c},{"./dagda/config/publicConfig":11,"./dagda/enums":14,"./dagda/events/HitEvent":18,"@vilynx/frontend-core/Logger":25}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("@vilynx/frontend-core/Logger"),i=function(e){return e&&e.__esModule?e:{default:e}}(o),r=e("../config/privateConfig"),a=function(){function e(){this._legacyMode=!0,this._logger=new i.default("[DAGDA_BEACON-"+r.privateConfig.pluginVersion+"]"),navigator&&navigator.sendBeacon&&(this._legacyMode=!1)}return e.prototype.send=function(e){return this._logger.debug("Making send events request."),this._legacyMode?this._gifSend(e):this._beaconSend(e)},e.prototype._beaconSend=function(e){return new Promise(function(t,n){navigator.sendBeacon(r.privateConfig.apiBasePath+"/b",'{"e":"'+e+'"}')?t():n()})},e.prototype._gifSend=function(e){return new Promise(function(t,n){var o=new Image;o.src=r.privateConfig.apiBasePath+"/b.gif?e="+e,o.style.display="none",o.style.visibility="hidden",o.addEventListener("load",t),o.addEventListener("error",n),document.body.appendChild(o)})},e}();n.default=new a},{"../config/privateConfig":10,"@vilynx/frontend-core/Logger":25}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.privateConfig=void 0;var o=e("@vilynx/frontend-core/enums/storage"),i=e("@vilynx/frontend-core/localstorage"),r=e("@vilynx/frontend-core/utils"),a=function(){function e(){this._isPluginReady=!1,this._apiBasePath="https://dagda.vilynx.com",this._pluginVersion="2.5.1",this._pluginName="dagda",this._uuid=i.ls.get("vlx_uuid",o.StorageFormat.plain)||(0,r.generateRandomUUID)(),i.ls.set("vlx_uuid",this._uuid,o.StorageFormat.plain)}return Object.defineProperty(e.prototype,"isPluginReady",{get:function(){return this._isPluginReady},set:function(e){this._isPluginReady=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"apiBasePath",{get:function(){return this._apiBasePath},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uuid",{get:function(){return this._uuid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pluginVersion",{get:function(){return this._pluginVersion},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pluginName",{get:function(){return this._pluginName},enumerable:!0,configurable:!0}),e}();n.privateConfig=new a},{"@vilynx/frontend-core/enums/storage":31,"@vilynx/frontend-core/localstorage":32,"@vilynx/frontend-core/utils":35}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.publicConfig=void 0;var o=e("@vilynx/frontend-core/config/coreConfig"),i=function(){function e(){this._device="desktop",this._godMode=!1,this._groupByActionIdThreshold=1e3,this._groupSameEventsThreshold=300,this._onLoad="(function(){})()",this._passiveTracking=!1,this._publickey="",this._sendDebounce=5e3,this._sendDelay=1e3,this._spaNavigation=!0,this._spaNavigationInterval=5e3}return Object.defineProperty(e.prototype,"publickey",{get:function(){return this._publickey},set:function(e){this._publickey=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"device",{get:function(){return this._device},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onLoad",{get:function(){return this._onLoad},set:function(e){this._onLoad=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"godMode",{get:function(){return this._godMode},set:function(e){this._godMode=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sendDelay",{get:function(){return Math.max(parseInt(this._sendDelay,10),50)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sendDebounce",{get:function(){return this._sendDebounce},set:function(e){this._sendDebounce=e},enumerable:!0,configurable:!0}),e.prototype.setValue=function(e,t){return void 0!==this["_"+e]?("true"===t.toLowerCase()?t=!0:"false"===t.toLowerCase()&&(t=!1),this["_"+e]=t,!0):0===e.indexOf("core")&&(e=e.replace("core",""),e=e.charAt(0).toLowerCase()+e.slice(1),o.coreConfig.setValue(e,t))},Object.defineProperty(e.prototype,"passiveTracking",{get:function(){return this._passiveTracking},set:function(e){this._passiveTracking=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groupSameEventsThreshold",{get:function(){return this._groupSameEventsThreshold},set:function(e){this._groupSameEventsThreshold=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groupByActionIdThreshold",{get:function(){return this._groupByActionIdThreshold},set:function(e){this._groupByActionIdThreshold=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spaNavigation",{get:function(){return this._spaNavigation},set:function(e){this._spaNavigation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spaNavigationInterval",{get:function(){return this._spaNavigationInterval},set:function(e){this._spaNavigationInterval=e},enumerable:!0,configurable:!0}),e}();n.publicConfig=new i},{"@vilynx/frontend-core/config/coreConfig":29}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=n.MediaEvents=void 0;!function(e){e.mediaPlay="mediaPlay",e.mediaPause="mediaPause",e.mediaEnd="mediaEnd",e.mediaUpdate="mediaUpdate"}(o||(n.MediaEvents=o={}));var i=n.TextEvents=void 0;!function(e){e.articleOpen="articleOpen",e.articleScroll="articleScroll"}(i||(n.TextEvents=i={}));var r=n.EventCategories=void 0;!function(e){e.mediaEvent="mediaEvent",e.textEvent="textEvent",e.galleryEvent="galleryEvent",e.recoEvent="recoEvent",e.hitEvent="hitEvent",e.loadEvent="loadEvent"}(r||(n.EventCategories=r={}));var a=n.EventStatus=void 0;!function(e){e.notSent="notSent",e.sending="sending",e.sent="sent"}(a||(n.EventStatus=a={}));var s=n.HitEvents=void 0;!function(e){e.pageLoad="pageLoad",e.spaNavigation="spaNavigation"}(s||(n.HitEvents=s={}))},{}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=n.GalleryEvents=void 0;!function(e){e.summaryShow="summaryShow",e.summaryStart="summaryStart",e.summaryEnd="summaryEnd",e.summaryLoop="summaryLoop",e.summaryClick="summaryClick"}(o||(n.GalleryEvents=o={}));var i=n.GalleryResolutions=void 0;!function(e){e.pro69high="pro69high",e.pro69="pro69",e.galleryPro69="galleryPro69",e.pro="pro",e.galleryShort="galleryShort",e.pro23high="pro23high",e.pro23="pro23",e.galleryPro23="galleryPro23"}(i||(n.GalleryResolutions=i={}))},{}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("./events");Object.defineProperty(n,"EventCategories",{enumerable:!0,get:function(){return o.EventCategories}}),Object.defineProperty(n,"EventStatus",{enumerable:!0,get:function(){return o.EventStatus}}),Object.defineProperty(n,"MediaEvents",{enumerable:!0,get:function(){return o.MediaEvents}});var i=e("./gallery");Object.defineProperty(n,"GalleryEvents",{enumerable:!0,get:function(){return i.GalleryEvents}}),Object.defineProperty(n,"GalleryResolutions",{enumerable:!0,get:function(){return i.GalleryResolutions}});var r=e("./reco");Object.defineProperty(n,"RecoEvents",{enumerable:!0,get:function(){return r.RecoEvents}}),Object.defineProperty(n,"HitEvents",{enumerable:!0,get:function(){return o.HitEvents}}),Object.defineProperty(n,"TextEvents",{enumerable:!0,get:function(){return o.TextEvents}})},{"./events":12,"./gallery":13,"./reco":15}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=n.RecoEvents=void 0;!function(e){e.enterViewport="enterViewport",e.mouseOver="mouseOver",e.click="click"}(o||(n.RecoEvents=o={}))},{}],16:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("@vilynx/frontend-core/utils"),r=e("../../DagdaException"),a=o(r),s=e("../beacon/beacon"),l=o(s),u=e("../config/privateConfig"),c=e("../config/publicConfig"),d=e("@vilynx/frontend-core/Pythonizer"),f=o(d),g=e("../enums"),v=function(){function e(e){if(this._sendAlone=!1,this._sendStatus=g.EventStatus.notSent,!e)throw new a.default("Event is required, none found on first parameter");this._evId=e._evId||(0,i.generateRandomHex)(8),this.url=e.url||window.location.href,this.originUrl=e.originUrl||document.referrer,this.publicKey=e.publicKey||c.publicConfig.publickey,this.eventTime=e.eventTime||+new Date}return e.prototype.canSend=function(){return this._sendStatus===g.EventStatus.notSent},e.prototype.isSent=function(){this._sendStatus=g.EventStatus.sent},e.prototype.getMeta=function(){return{GUID:this._evId,UA:navigator.userAgent,UUID:u.privateConfig.uuid,screen_size:window.screen.availHeight+"x"+window.screen.availWidth}},e.prototype.send=function(){var e=this;this.sending(),this._sendAlone=!0;var t=btoa(JSON.stringify(this));return l.default.send(t).then(function(){e.isSent()})},e.prototype.sending=function(){this._sendStatus=g.EventStatus.sending},e.prototype.checkHasAllPropertiesOf=function(e){e.eventCategory=e.category,delete e.category;var t=Object.keys(this);Object.keys(e).map(function(e){return"event_id"===e?"_evId":f.default.toCamel(e)}).forEach(function(e){if(!t.includes(e))throw new a.default("Current dagda version does not support all the event fields passed to the constructor")})},e}();n.default=v},{"../../DagdaException":3,"../beacon/beacon":9,"../config/privateConfig":10,"../config/publicConfig":11,"../enums":14,"@vilynx/frontend-core/Pythonizer":26,"@vilynx/frontend-core/utils":35}],17:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("@vilynx/frontend-core/Pythonizer"),r=o(i),a=e("../../DagdaException"),s=o(a),l=e("../enums/"),u=e("./BaseEvent"),c=o(u),d=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),f=function(e){function t(t){var n=this;if(!t)throw new s.default("Event is required, none found on first parameter");return n=e.call(this,t)||this,n.eventCategory=l.EventCategories.galleryEvent,n.eventType=t.eventType,t.actionId&&(n.actionId=t.actionId),n.previewHash=t.previewHash,n.currentTime=t.currentTime,n.isRedirect=t.isRedirect||!1,n.resolution=t.resolution,n.passiveTracking=t.passiveTracking,n._guaranteeGalleryEvent(t),n}return d(t,e),t.prototype.toJSON=function(){var e={action_id:this.actionId,category:r.default.toSnake(this.eventCategory),current_time:this.currentTime,event_id:this._evId,event_time:this.eventTime,event_type:r.default.toSnake(this.eventType),origin_url:this.originUrl,passive_tracking:this.passiveTracking,preview_hash:this.previewHash,public_key:this.publicKey,resolution:this.resolution,url:this.url};return this.eventType===l.GalleryEvents.summaryClick&&(e.is_redirect=this.isRedirect),this._sendAlone?{_meta_:this.getMeta(),event:e}:e},t.prototype._guaranteeGalleryEvent=function(e){if(e.eventType in l.GalleryEvents==!1)throw new s.default('"event.eventType" must be one of the following: ('+Object.getOwnPropertyNames(l.GalleryEvents)+") ");if("string"!=typeof e.previewHash)throw new s.default('"event.elementGuid" must be a string and a valid GUID.');if(isNaN(e.currentTime))throw new s.default('"event.currentTime" must be valid number.');if(e.url&&"string"!=typeof e.url)throw new s.default('"event.url" must be valid string.');if(e.isRedirect&&"boolean"!=typeof e.isRedirect)throw new s.default('"event.isRedirect" must be valid boolean.');if(e.resolution in l.GalleryResolutions==!1)throw new s.default('"event.resolution" must be one of the following: ('+Object.getOwnPropertyNames(l.GalleryResolutions)+") ");return!0},t}(c.default);n.default=f},{"../../DagdaException":3,"../enums/":14,"./BaseEvent":16,"@vilynx/frontend-core/Pythonizer":26}],18:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("@vilynx/frontend-core/Pythonizer"),r=o(i),a=e("../../DagdaException"),s=o(a),l=e("../enums"),u=e("./BaseEvent"),c=o(u),d=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),f=function(e){function t(t){var n=this;if(!t)throw new s.default("Event is required, none found on first parameter");return n=e.call(this,t)||this,n.eventCategory=l.EventCategories.hitEvent,n.passiveTracking=t.passiveTracking,n.eventType=t.eventType,n._guaranteeHitEvent(t),n}return d(t,e),t.prototype.toJSON=function(){var e={category:r.default.toSnake(this.eventCategory),event_id:this._evId,event_time:this.eventTime,event_type:r.default.toSnake(this.eventType),origin_url:this.originUrl,passive_tracking:this.passiveTracking,public_key:this.publicKey,url:this.url};return this._sendAlone?{_meta_:this.getMeta(),event:e}:e},t.prototype._guaranteeHitEvent=function(e){if(e.eventType in l.HitEvents==!1)throw new s.default('"event.eventType" must be one of the following: ('+Object.getOwnPropertyNames(l.HitEvents)+") ");return!0},t}(c.default);n.default=f},{"../../DagdaException":3,"../enums":14,"./BaseEvent":16,"@vilynx/frontend-core/Pythonizer":26}],19:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("@vilynx/frontend-core/Pythonizer"),r=o(i),a=e("../../DagdaException"),s=o(a),l=e("../enums/events"),u=e("./BaseEvent"),c=o(u),d=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),f=function(e){function t(t){var n=this;if(!t)throw new s.default("Event is required, none found on first parameter");return n=e.call(this,t)||this,n.pluginName=t.pluginName,n.pluginVersion=t.pluginVersion,n.eventCategory=l.EventCategories.loadEvent,n._guaranteeLoadEvent(t),n}return d(t,e),t.prototype.toJSON=function(){var e={category:r.default.toSnake(this.eventCategory),event_id:this._evId,event_time:this.eventTime,origin_url:this.originUrl,plugin_name:this.pluginName,plugin_version:this.pluginVersion,public_key:this.publicKey,url:this.url};return this._sendAlone?{_meta_:this.getMeta(),event:e}:e},t.prototype._guaranteeLoadEvent=function(e){if(e.url&&"string"!=typeof e.url)throw new s.default('"event.url" must be valid string.');return!0},t}(c.default);n.default=f},{"../../DagdaException":3,"../enums/events":12,"./BaseEvent":16,"@vilynx/frontend-core/Pythonizer":26}],20:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("@vilynx/frontend-core/Pythonizer"),r=o(i),a=e("../../DagdaException"),s=o(a),l=e("../enums"),u=e("./BaseEvent"),c=o(u),d=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),f=function(e){function t(t){var n=this;if(!t)throw new s.default("Event is required, none found on first parameter");return n=e.call(this,t)||this,n.eventCategory=l.EventCategories.mediaEvent,n.eventType=t.eventType,n.elementId=t.elementId,n.currentTime=t.currentTime,n}return d(t,e),t.prototype.toJSON=function(){var e={category:r.default.toSnake(this.eventCategory),current_time:r.default.toSnake(this.currentTime),element_id:this.elementId,event_id:this._evId,event_time:this.eventTime,event_type:r.default.toSnake(this.eventType),origin_url:this.originUrl,public_key:this.publicKey,url:this.url};return this._sendAlone?{_meta_:this.getMeta(),event:e}:e},t.prototype._guaranteeMediaEvent=function(e){if(e.eventType in l.MediaEvents==!1)throw new s.default('"event.eventType" must be one of the following: ('+Object.getOwnPropertyNames(l.MediaEvents)+") ");if("string"!=typeof e.elementId)throw new s.default('"event.elementId" must be a string and a valid GUID.');if(isNaN(e.currentTime))throw new s.default('"event.currentTime" must be valid number.');if(e.url&&"string"!=typeof e.url)throw new s.default('"event.url" must be valid string.');return!0},t}(c.default);n.default=f},{"../../DagdaException":3,"../enums":14,"./BaseEvent":16,"@vilynx/frontend-core/Pythonizer":26}],21:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0})
;var i=e("@vilynx/frontend-core/Pythonizer"),r=o(i),a=e("."),s=e("../../DagdaException"),l=o(s),u=e("../enums"),c=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=function(e){function t(t){var n=e.call(this,t)||this;return t.actionId&&(n.actionId=t.actionId),n.eventCategory=u.EventCategories.recoEvent,n.eventType=t.eventType,n.elemHash=t.elemHash,n._guaranteeRecoEvent(t),n}return c(t,e),t.prototype.toJSON=function(){var e={action_id:this.actionId,category:r.default.toSnake(this.eventCategory),elem_hash:this.elemHash,event_id:this._evId,event_time:this.eventTime,event_type:r.default.toSnake(this.eventType),origin_url:this.originUrl,public_key:this.publicKey,url:this.url};return this._sendAlone?{_meta_:this.getMeta(),event:e}:e},t.prototype._guaranteeRecoEvent=function(e){if(e.eventType in u.RecoEvents==!1)throw new l.default('"event.eventType" must be one of the following: ('+Object.getOwnPropertyNames(u.RecoEvents)+")");if("string"!=typeof e.elemHash)throw new l.default('"event.elemHash" must be a string and a valid GUID.');return!0},t}(a.BaseEvent);n.default=d},{".":23,"../../DagdaException":3,"../enums":14,"@vilynx/frontend-core/Pythonizer":26}],22:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("@vilynx/frontend-core/Pythonizer"),r=o(i),a=e("."),s=e("../../DagdaException"),l=o(s),u=e("../enums/events"),c=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=function(e){function t(t){var n=this;if(!t)throw new l.default("Event is required, none found on first parameter");return n=e.call(this,t)||this,n.eventCategory=u.EventCategories.textEvent,n.elementId=t.elementId,n.eventType=t.eventType,n.scrollPercentage=t.scrollPercentage,n._guaranteeTextEvent(t),n}return c(t,e),t.prototype.toJSON=function(){var e={category:r.default.toSnake(this.eventCategory),element_id:this.elementId,event_id:this._evId,event_time:this.eventTime,event_type:r.default.toSnake(this.eventType),origin_url:this.originUrl,public_key:this.publicKey,scroll_percentage:this.scrollPercentage,url:this.url};return this._sendAlone?{_meta_:this.getMeta(),event:e}:e},t.prototype._guaranteeTextEvent=function(e){if(e.eventType in u.TextEvents==!1)throw new l.default('"event.eventType" must be one of the following: ('+Object.getOwnPropertyNames(u.TextEvents)+")");if("string"!=typeof e.elementId)throw new l.default('"event.elementGuid" must be a string and a valid GUID.');if(isNaN(e.scrollPercentage))throw new l.default('"event.scrollPercentage" must be a number between 0 and 100.');return!0},t}(a.BaseEvent);n.default=d},{".":23,"../../DagdaException":3,"../enums/events":12,"@vilynx/frontend-core/Pythonizer":26}],23:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./BaseEvent");Object.defineProperty(n,"BaseEvent",{enumerable:!0,get:function(){return o(i).default}});var r=e("./MediaEvent");Object.defineProperty(n,"MediaEvent",{enumerable:!0,get:function(){return o(r).default}});var a=e("./GalleryEvent");Object.defineProperty(n,"GalleryEvent",{enumerable:!0,get:function(){return o(a).default}});var s=e("./RecoEvent");Object.defineProperty(n,"VidrecEvent",{enumerable:!0,get:function(){return o(s).default}});var l=e("./TextEvent");Object.defineProperty(n,"TextEvent",{enumerable:!0,get:function(){return o(l).default}});var u=e("./HitEvent");Object.defineProperty(n,"HitEvent",{enumerable:!0,get:function(){return o(u).default}}),Object.defineProperty(n,"RecoEvent",{enumerable:!0,get:function(){return o(s).default}});var c=e("./LoadEvent");Object.defineProperty(n,"LoadEvent",{enumerable:!0,get:function(){return o(c).default}})},{"./BaseEvent":16,"./GalleryEvent":17,"./HitEvent":18,"./LoadEvent":19,"./MediaEvent":20,"./RecoEvent":21,"./TextEvent":22}],24:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.DagdaSession=void 0;var i=e("@vilynx/frontend-core/browser"),r=e("@vilynx/frontend-core/Logger"),a=o(r),s=e("@vilynx/frontend-core/utils"),l=e("./dagda/config/privateConfig"),u=e("./dagda/config/publicConfig"),c=e("./dagda/enums"),d=e("./dagda/events"),f=e("./DagdaEventGroup"),g=o(f),v=e("./EventsStorage"),h=o(v),p=function(){function e(){var e=this;this.events=[],this.initEvents=[],this._unsentEvents=0,this._logger=new a.default("[DAGDA_Session-"+l.privateConfig.pluginVersion+"]"),0!==u.publicConfig.sendDelay?(this._logger.info("Timeout to send events set to "+u.publicConfig.sendDebounce),this._eventsStorage=new h.default,this._eventsStorage.restoreEvents().then(function(t){e._logger.debug(t.length+" events were successfully restored."),e.events=e.events.concat(t),e.sendEvents(),e._eventsStorage.clearUnsent(),window.setTimeout(function(){e._sendEventsInterval=window.setInterval(function(){e.sendEvents().then(function(){}).catch(function(){e._logger.info("No events to send")})},u.publicConfig.sendDelay)},u.publicConfig.sendDebounce)}).catch(function(){e._logger.debug("Events could not be restored, just starting schedule without them."),window.setTimeout(function(){e._sendEventsInterval=window.setInterval(function(){e.sendEvents().then(function(){}).catch(function(){e._logger.info("No events to send")})},u.publicConfig.sendDelay)},u.publicConfig.sendDebounce)})):this._logger.info("Send delay is set to 0, dagda session is useless"),this.addUnloadListeners()}return e.prototype.push=function(e){this._logger.info("New event Added",e),this._groupEventByActionId(e),this.events.push(e),this._unsentEvents+=1},e.prototype.sendEvents=function(){var e=this,t=this.getEventsReadyToSend();return t.splice(20,t.length),new Promise(function(n,o){if(t.length>0){var i=new g.default(t);i.sendGroup().then(function(){i=void 0,t.forEach(function(e){return e.isSent()}),e._eventsStorage.clearUnsent(),n()}).catch(function(){e._logger.warn("Failed to send "+t.length+". Restoring event status"),t.forEach(function(e){return e.canSend()})})}else n()})},e.prototype.addEventsFromOldDagda=function(e){var t=this;this._logger.info("Adding events from old Dagda");var n;try{n=JSON.parse(e.events)}catch(e){this._logger.error("There was an error parsing the events from an old Dagda instance.")}n&&(n.forEach(function(e){var n;try{n=t._eventsStorage.rawToEvent(e)}catch(n){t._logger.error("Exception parsing event",e,n)}n&&(t.events.some(function(e){return t._areSameEvent(e,n)})||(t._logger.debug("It does not exist an event equal to "+n+". Pushing it."),t.push(n)))}),this._logger.debug("Added "+n.length+" events from old Dagda."))},e.prototype._areSameEvent=function(e,t){return e instanceof d.GalleryEvent&&t instanceof d.GalleryEvent?this._areSameBaseEvent(e,t)&&e.previewHash===t.previewHash&&e.currentTime===t.currentTime&&e.eventType===t.eventType:e instanceof d.RecoEvent&&t instanceof d.RecoEvent?this._areSameBaseEvent(e,t)&&e.elemHash===t.elemHash&&e.eventType===t.eventType:this._areSameBaseEvent(e,t)&&e.constructor===t.constructor},e.prototype._areSameBaseEvent=function(e,t){return e.eventCategory===t.eventCategory&&e.publicKey===t.publicKey&&e.url===t.url&&Math.floor(e.eventTime/u.publicConfig.groupSameEventsThreshold)===Math.floor(t.eventTime/u.publicConfig.groupSameEventsThreshold)},e.prototype.stopSendingEvents=function(){this._logger.debug("Stopping send events interval"),clearInterval(this._sendEventsInterval)},e.prototype.clearEventsArray=function(){this._logger.debug("Clearing events array."),this.events=null},e.prototype.unloadFn=function(){this._logger.debug("Storing unsent events to LocalStorage"),this._storeUnsent()},e.prototype.addUnloadListeners=function(){this._logger.debug("Adding page unload listeners"),this._bindedUnloadFn=this.unloadFn.bind(this),i.browser.isIos?window.addEventListener("pagehide",this._bindedUnloadFn,!1):window.addEventListener("beforeunload",this._bindedUnloadFn,!1)},e.prototype.removeUnloadListeners=function(){this._logger.debug("Removing page unload listeners"),i.browser.isIos?window.removeEventListener("pagehide",this._bindedUnloadFn,!1):window.removeEventListener("beforeunload",this._bindedUnloadFn,!1)},e.prototype._groupEventByActionId=function(e){var t=this;this.events.forEach(function(n){var o=t._getRecoAndGalleryEvent(n,e),i=o[0],r=o[1];if(![i,r].some(function(e){return void 0===e})&&void 0===r.actionId&&void 0===i.actionId&&r.eventType===c.GalleryEvents.summaryClick&&i.eventType===c.RecoEvents.click&&Math.floor(n.eventTime/u.publicConfig.groupByActionIdThreshold)===Math.floor(e.eventTime/u.publicConfig.groupByActionIdThreshold)){var a=(0,s.generateRandomHex)(8);i.actionId=a,r.actionId=a}})},e.prototype._getRecoAndGalleryEvent=function(e,t){return e.eventCategory===c.EventCategories.recoEvent&&t.eventCategory===c.EventCategories.galleryEvent?[e,t]:e.eventCategory===c.EventCategories.galleryEvent&&t.eventCategory===c.EventCategories.recoEvent?[t,e]:[void 0,void 0]},e.prototype.getAllPendingEvents=function(){return[].concat(this.events.filter(function(e){return e.canSend()})).concat(this.initEvents.filter(function(e){return e.canSend()}))},e.prototype.getEventsReadyToSend=function(){var e=this.events?this.events.filter(function(e){return e.canSend()}):[];return e.length&&this.initEvents.length&&(e=e.concat(this.initEvents.filter(function(e){return e.canSend()}))),e},e.prototype._storeUnsent=function(){var e=this.getEventsReadyToSend();this._eventsStorage.storeEvents(e)},e}();n.DagdaSession=p},{"./DagdaEventGroup":2,"./EventsStorage":7,"./dagda/config/privateConfig":10,"./dagda/config/publicConfig":11,"./dagda/enums":14,"./dagda/events":23,"@vilynx/frontend-core/Logger":25,"@vilynx/frontend-core/browser":28,"@vilynx/frontend-core/utils":35}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("./config/coreConfig"),i=e("./enums/logger"),r=function(){function e(e){switch(void 0===e&&(e="[_VLX_] "),this._prefix="[_VLX_] ",this._prefix=e,this.info=this.debug=this.warn=this.error=function(){},this.critical=Function.prototype.bind.call(console.error,console,"!!CRITICAL ERROR!!",this._prefix),o.coreConfig.logLevel){case i.LogLevel.info:this.info=Function.prototype.bind.call(console.info,console,this._prefix);break;case i.LogLevel.develop:this.info=Function.prototype.bind.call(console.info,console,this._prefix),this.debug=Function.prototype.bind.call(console.info,console,this._prefix),this.warn=Function.prototype.bind.call(console.warn,console,this._prefix),this.error=Function.prototype.bind.call(console.error,console,this._prefix)}}return e}();n.default=r},{"./config/coreConfig":29,"./enums/logger":30}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(){}return e.prototype.toSnake=function(e){return this._convertTo(e,!0)},e.prototype.toCamel=function(e){return this._convertTo(e,!1)},e.prototype._convertTo=function(e,t){if("string"==typeof e)return t?this._buildKeySnake(e):this._buildKeyCamel(e);if(Array.isArray(e))return t?e.map(this.toSnake,this):e.map(this.toCamel,this);if(e&&"object"===(void 0===e?"undefined":o(e))){var n={};for(var i in e)if(Object.hasOwnProperty.call(e,i)){var r=t?this._buildKeySnake(i):this._buildKeyCamel(i);n[r]=t?this.toSnake(e[i]):this.toCamel(e[i])}return n}return e},e.prototype._buildKeyCamel=function(e){return e.replace(/_./g,function(e){return e.slice(1,2).toUpperCase()})},e.prototype._buildKeySnake=function(e){return e.replace(/(?!^)([A-Z])/g,function(e){return"_"+e.toLowerCase()}).toLowerCase()},e}();n.default=new i},{}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=n.VersionIs=void 0;!function(e){e[e.greater=0]="greater",e[e.lower=1]="lower",e[e.equal=2]="equal"}(o||(n.VersionIs=o={}));var i=function(){function e(){}return e.checkVersion=function(e,t){for(var n=e.split("."),i=t.split("."),r=0;r<i.length;){if(n[r]<i[r])return o.lower;if(n[r]>i[r])return o.greater;r+=1}return o.equal},e}();n.default=i},{}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(){this.ua=navigator.userAgent.toLowerCase(),this.isMozilla=this._dr("firefox"),this.isWebkit=this._dr("webkit"),this.isOpera=this._dr("opera"),this.isMsie=this._dr("msie|trident|edge"),this.isIe=this._dr("trident"),this.isEdge=this._dr("edge"),this.isIe10=this._dr("msie"),this.isChrome=this._dr("chrome"),this.isAndroid=this._dr("android"),this.isIos=this._dr("iphone|ipad|ipod"),this.isIpad=this._dr("ipad"),this.isAndroidTablet=this.isAndroid&&this._dr("^mobile"),this.isTablet=this.isIpad||this.isAndroidTablet,this.isIphone=this._dr("iphone"),this.isOperaMini=this._dr("opera mini"),this.isWindowsMobile=this._dr("iemobile"),this.isKindle=this._dr("kindle|silk|kftt|kfot|kfjwa|kfjwi"),this.isMobile=this.isAndroid||this.isIos||this.isIphone||this.isOperaMini||this.isWindowsMobile||this.isKindle,this.isOldIphone=this.isIphone&&window.screen.height/window.screen.width==1.5&&window.devicePixelRatio<=2,this.isSafari=this._checkIsSafari()}return e.prototype._dr=function(e){return new RegExp(e).test(this.ua)},e.prototype._checkIsSafari=function(){var e;return!!this._dr("^((?!chrome).)*safari")&&(e=this.ua.search("version/"),parseInt(this.ua.substr(e+8,3),10))},e}();n.Browser=o;n.browser=new o},{}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.coreConfig=void 0;var o=e("../enums/logger"),i=function(){function e(){this._logLevel=o.LogLevel.nope,this._xhrMaxRetry=5,this._xhrRetryTime=1e3,this._xhrTimeout=1e3}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){this._logLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"xhrMaxRetry",{get:function(){return this._xhrMaxRetry},set:function(e){this._xhrMaxRetry=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"xhrTimeout",{get:function(){return this._xhrTimeout},set:function(e){this._xhrTimeout=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"xhrRetryTime",{get:function(){return this._xhrRetryTime},set:function(e){this._xhrRetryTime=e},enumerable:!0,configurable:!0}),e.prototype.setValue=function(e,t){return void 0!==this["_"+e]&&("true"===t.toLowerCase()?t=!0:"false"===t.toLowerCase()&&(t=!1),this["_"+e]=t,!0)},e}();n.coreConfig=new i},{"../enums/logger":30}],30:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=n.LogLevel=void 0;!function(e){e.nope="nope",e.info="info",e.develop="develop"}(o||(n.LogLevel=o={}))},{}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=n.StorageFormat=void 0;!function(e){e.base64="base64",e.json="json",e.plain="plain"}(o||(n.StorageFormat=o={}));var i=n.StorageType=void 0;!function(e){e[e.sessionStorage=0]="sessionStorage",e[e.localStorage=1]="localStorage"}(i||(n.StorageType=i={}))},{}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ls=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("./enums/storage"),r=e("./Logger"),a=function(e){return e&&e.__esModule?e:{default:e}}(r),s=e("./storage/exceptions"),l=function(){function e(){this._isLocalStorageAvailable=!0,this._logger=new a.default("[LS]");try{var e="__storage_test__";localStorage.setItem(e,e),localStorage.removeItem(e)}catch(e){this._isLocalStorageAvailable=!1,this._logger.warn("localStorage is not available")}}return e.prototype.get=function(e,t){if(!this._isLocalStorageAvailable)return this._logger.warn("localStorage is not available"),!1;this._logger.info("Getting "+e+" from local storage");var n=localStorage.getItem(e);if(n)switch(t){case i.StorageFormat.base64:try{n=atob(n)||!1}catch(e){n=!1}break;case i.StorageFormat.json:try{n=JSON.parse(n)||!1}catch(e){n=!1}break;case i.StorageFormat.plain:}return n},e.prototype.set=function(e,t,n){if(!this._isLocalStorageAvailable)return void this._logger.warn("localStorage is not available");var r;switch(this._logger.info("Saving "+e+" to local storage"),n){case i.StorageFormat.base64:try{r=btoa(t.toString())}catch(i){throw this._logger.error("Failed to convert to BASE64 (name, element, format)",e,t,n),new s.ConversionException("Can't convert from "+(void 0===t?"undefined":o(t))+" to base64")}break;case i.StorageFormat.json:try{r=JSON.stringify(t)}catch(i){throw this._logger.error("Failed to convert to JSON (name, element, format)",e,t,n),new s.ConversionException("Can't convert from "+(void 0===t?"undefined":o(t))+" to base64")}break;case i.StorageFormat.plain:r=t.toString()}try{localStorage.setItem(e,r)}catch(e){throw this._logger.error("Can't save to local storage. Maybe it's full",e),new s.StorageException("Can't save to local storage. Maybe it's full")}return e},e.prototype.remove=function(e){if(!this._isLocalStorageAvailable)return void this._logger.warn("localStorage is not available");this._logger.info("Removing "+e+" from local storage"),localStorage.removeItem(e)},e}();n.ls=new l},{"./Logger":25,"./enums/storage":31,"./storage/exceptions":34}],33:[function(e,t,n){(function(o,i){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,o){"object"==(void 0===n?"undefined":r(n))&&void 0!==t?t.exports=o():"function"==typeof define&&define.amd?define(o):e.ES6Promise=o()}(void 0,function(){function t(e){var t=void 0===e?"undefined":r(e);return null!==e&&("object"===t||"function"===t)}function n(e){return"function"==typeof e}function a(e){B=e}function s(e){G=e}function l(){return void 0!==q?function(){q(c)}:u()}function u(){var e=setTimeout;return function(){return e(c,1)}}function c(){for(var e=0;e<H;e+=2){(0,Y[e])(Y[e+1]),Y[e]=void 0,Y[e+1]=void 0}H=0}function d(e,t){var n=this,o=new this.constructor(g);void 0===o[Q]&&L(o);var i=n._state;if(i){var r=arguments[i-1];G(function(){return T(i,o,r,n._result)})}else C(n,o,e,t);return o}function f(e){var t=this;if(e&&"object"==(void 0===e?"undefined":r(e))&&e.constructor===t)return e;var n=new t(g);return w(n,e),n}function g(){}function v(){return new TypeError("You cannot resolve a promise with itself")}function h(){return new TypeError("A promises callback cannot return that same promise.")}function p(e){try{return e.then}catch(e){return ne.error=e,ne}}function m(e,t,n,o){try{e.call(t,n,o)}catch(e){return e}}function y(e,t,n){G(function(e){var o=!1,i=m(n,t,function(n){o||(o=!0,t!==n?w(e,n):S(e,n))},function(t){o||(o=!0,x(e,t))},"Settle: "+(e._label||" unknown promise"));!o&&i&&(o=!0,x(e,i))},e)}function _(e,t){t._state===ee?S(e,t._result):t._state===te?x(e,t._result):C(t,void 0,function(t){return w(e,t)},function(t){return x(e,t)})}function b(e,t,o){t.constructor===e.constructor&&o===d&&t.constructor.resolve===f?_(e,t):o===ne?(x(e,ne.error),ne.error=null):void 0===o?S(e,t):n(o)?y(e,t,o):S(e,t)}function w(e,n){e===n?x(e,v()):t(n)?b(e,n,p(n)):S(e,n)}function E(e){e._onerror&&e._onerror(e._result),k(e)}function S(e,t){e._state===Z&&(e._result=t,e._state=ee,0!==e._subscribers.length&&G(k,e))}function x(e,t){e._state===Z&&(e._state=te,e._result=t,G(E,e))}function C(e,t,n,o){var i=e._subscribers,r=i.length;e._onerror=null,i[r]=t,i[r+ee]=n,i[r+te]=o,0===r&&e._state&&G(k,e)}function k(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var o=void 0,i=void 0,r=e._result,a=0;a<t.length;a+=3)o=t[a],i=t[a+n],o?T(n,o,i,r):i(r);e._subscribers.length=0}}function O(e,t){try{return e(t)}catch(e){return ne.error=e,ne}}function T(e,t,o,i){var r=n(o),a=void 0,s=void 0,l=void 0,u=void 0;if(r){if(a=O(o,i),a===ne?(u=!0,s=a.error,a.error=null):l=!0,t===a)return void x(t,h())}else a=i,l=!0;t._state!==Z||(r&&l?w(t,a):u?x(t,s):e===ee?S(t,a):e===te&&x(t,a))}function P(e,t){try{t(function(t){w(e,t)},function(t){x(e,t)})}catch(t){x(e,t)}}function M(){return oe++}function L(e){e[Q]=oe++,e._state=void 0,e._result=void 0,e._subscribers=[]}function I(){return new Error("Array Methods must be provided an Array")}function j(e){return new ie(this,e).promise}function R(e){var t=this;return new t(F(e)?function(n,o){for(var i=e.length,r=0;r<i;r++)t.resolve(e[r]).then(n,o)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function V(e){var t=this,n=new t(g);return x(n,e),n}function D(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function N(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function A(){var e=void 0;if(void 0!==i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=re}var U=void 0;U=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var F=U,H=0,q=void 0,B=void 0,G=function(e,t){Y[H]=e,Y[H+1]=t,2===(H+=2)&&(B?B(c):$())},z="undefined"!=typeof window?window:void 0,J=z||{},W=J.MutationObserver||J.WebKitMutationObserver,K="undefined"==typeof self&&void 0!==o&&"[object process]"==={}.toString.call(o),X="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Y=new Array(1e3),$=void 0;$=K?function(){return function(){return o.nextTick(c)}}():W?function(){var e=0,t=new W(c),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}():X?function(){var e=new MessageChannel;return e.port1.onmessage=c,function(){return e.port2.postMessage(0)}}():void 0===z&&"function"==typeof e?function(){try{var e=Function("return this")().require("vertx");return q=e.runOnLoop||e.runOnContext,l()}catch(e){return u()}}():u();var Q=Math.random().toString(36).substring(2),Z=void 0,ee=1,te=2,ne={error:null},oe=0,ie=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(g),this.promise[Q]||L(this.promise),F(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?S(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&S(this.promise,this._result))):x(this.promise,I())}return e.prototype._enumerate=function(e){for(var t=0;this._state===Z&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,o=n.resolve;if(o===f){var i=p(e);if(i===d&&e._state!==Z)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(n===re){var r=new n(g);b(r,e,i),this._willSettleAt(r,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(o(e),t)},e.prototype._settledAt=function(e,t,n){var o=this.promise;o._state===Z&&(this._remaining--,e===te?x(o,n):this._result[t]=n),0===this._remaining&&S(o,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;C(e,void 0,function(e){return n._settledAt(ee,t,e)},function(e){return n._settledAt(te,t,e)})},e}(),re=function(){function e(t){this[Q]=M(),this._result=this._state=void 0,this._subscribers=[],g!==t&&("function"!=typeof t&&D(),this instanceof e?P(this,t):N())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var t=this,n=t.constructor;return t.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})})},e}();return re.prototype.then=d,re.all=j,re.race=R,re.resolve=f,re.reject=V,re._setScheduler=a,re._setAsap=s,re._asap=G,re.polyfill=A,re.Promise=re,re.polyfill(),re})}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:36}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e){this.message=e}return e}();n.ConversionException=o;var i=function(){function e(e){this.message=e}return e}();n.StorageException=i},{}],35:[function(e,t,n){"use strict";function o(e){void 0===e&&(e=4);for(var t=Math.pow(16,Math.min(e,8)-1),n=Math.pow(16,Math.min(e,8))-1,i=Math.floor(Math.random()*(n-t+1))+t,r=i.toString(16);r.length<e;)r+=o(e-8);return r}function i(){var e=o;return e(8)+"-"+e()+"-"+e()+"-"+e()+"-"+e(12)}function r(e){if(e.dataset)return e.dataset;for(var t=e.attributes,n=t.length,o=function(e){return e.charAt(1).toUpperCase()},i={},r=0;r<n;r++){var a=t[r];if(a&&a.name&&/^data-\w[\w\-]*$/.test(a.name)){var s=a.value;i[a.name.substr(5).replace(/-./g,o)]=s}}return i}Object.defineProperty(n,"__esModule",{value:!0}),n.generateRandomHex=o,n.generateRandomUUID=i,n.getDataset=r},{}],36:[function(e,t,n){"use strict";function o(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function r(e){if(d===setTimeout)return setTimeout(e,0);if((d===o||!d)&&setTimeout)return d=setTimeout,setTimeout(e,0);try{return d(e,0)}catch(t){try{return d.call(null,e,0)}catch(t){return d.call(this,e,0)}}}function a(e){if(f===clearTimeout)return clearTimeout(e);if((f===i||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function s(){p&&v&&(p=!1,v.length?h=v.concat(h):m=-1,h.length&&l())}function l(){if(!p){var e=r(s);p=!0;for(var t=h.length;t;){for(v=h,h=[];++m<t;)v&&v[m].run();m=-1,t=h.length}v=null,p=!1,a(e)}}function u(e,t){this.fun=e,this.array=t}function c(){}var d,f,g=t.exports={};!function(){try{d="function"==typeof setTimeout?setTimeout:o}catch(e){d=o}try{f="function"==typeof clearTimeout?clearTimeout:i}catch(e){f=i}}();var v,h=[],p=!1,m=-1;g.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new u(e,t)),1!==h.length||p||r(l)},u.prototype.run=function(){this.fun.apply(null,this.array)},g.title="browser",g.browser=!0,g.env={},g.argv=[],g.version="",g.versions={},g.on=c,g.addListener=c,g.once=c,g.off=c,g.removeListener=c,g.removeAllListeners=c,g.emit=c,g.prependListener=c,g.prependOnceListener=c,g.listeners=function(e){return[]},g.binding=function(e){throw new Error("process.binding is not supported")},g.cwd=function(){return"/"},g.chdir=function(e){throw new Error("process.chdir is not supported")},g.umask=function(){return 0}},{}],37:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o={userid:!1,publickey:!1,feedhash:"",debug:!1,onpluginload:"",currenturl:"",limit:5,overrideurl:!1,onlyrelated:!1,retrieveguid:!1,urlsplitchar:!1,urlfilterregex:!1,domain:"",cf:!1,disablecf:!1,cfwo:!1,confighash:!1,temprules:!1,idattribute:!1,returnmetadata:!1,minelemwidth:200,minelemheight:180,minelemspacing:5,excludeRelated:!1,excludeTrending:!1,excludeMostViewed:!1,userProfileMaxSize:100,userProfileMaxRecommendations:3,viewedMaxSize:300,userprofilettl:2,disablestorage:!1,maxapirel:40,maxapitrend:40,maxapiviews:40,percentedomairecommend:.6,domainpercentage:!1,sharedls:!1,iframed:!1,preloadoffset:300,displayallscores:!1,analytics:!1,recommendationscontainer:null,dynamicFilter:null};n.default=o},{}],38:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o={serverurl:"https://www.vilynx.com",cndUrl:"https://static.vilynx.com/vidrec",publicUrl:"https://public.vilynx.com",version:"3.1.2",maxRetries:100,retryTime:1e3,cleanUrlRegex:/(^\w+:|^)\/\//};n.default=o},{}],39:[function(require,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),_globalConfig=require("./config/globalConfig"),_globalConfig2=_interopRequireDefault(_globalConfig),_privateConfig=require("./config/privateConfig"),_privateConfig2=_interopRequireDefault(_privateConfig),_computator=require("./modules/computator"),_computator2=_interopRequireDefault(_computator),_messenger=require("./modules/helpers/comm/internal/messenger"),_messenger2=_interopRequireDefault(_messenger),_recommendationsFinder=require("./modules/helpers/dom/recommendationsFinder"),_localStorage=require("./modules/helpers/storage/localStorage"),_localStorageUpdater=require("./modules/helpers/storage/localStorageUpdater"),_sessionStorage=require("./modules/helpers/storage/sessionStorage"),_logger=require("./modules/helpers/utils/logger"),_vidhtml=require("./modules/vidhtml"),_vidhtml2=_interopRequireDefault(_vidhtml);require("./polyfills/classList"),require("./polyfills/customEvent"),require("./polyfills/mutationObserver"),require("./polyfills/path"),require("./modules/helpers/dom/scrollMonitor");var _recommendationsListener=require("./modules/analytics/recommendationsListener"),_recommendationsListener2=_interopRequireDefault(_recommendationsListener),_eventsHandler=require("./modules/analytics/eventsHandler"),_eventsHandler2=_interopRequireDefault(_eventsHandler),_analytics=require("./modules/analytics/analytics"),_analytics2=_interopRequireDefault(_analytics),Recommendator=function(){function Recommendator(){var e=this;if(_classCallCheck(this,Recommendator),this.loadGlobalConfig()){"complete"===document.readyState||"interactive"===document.readyState?this.executeVidrec():document.addEventListener("DOMContentLoaded",function(){e.executeVidrec()})}else _logger.logger.error("FUBAR: Can't load config. Aborting")}return _createClass(Recommendator,[{key:"executeVidrec",value:function executeVidrec(){var _this2=this;_logger.logger.log("this log does nothing, nothing de nothing"),_globalConfig2.default.debug||(_globalConfig2.default.debug=_localStorage.ls.get("vilynx_results")||!1);var vxClicked=_sessionStorage.ss.get("vx_clicked")||!1;if(vxClicked&&_recommendationsFinder.recommendationFinder.sendClickEvent(vxClicked,!0),_localStorageUpdater.localStorageUpdater.validateLocalStorage(),this.computador=new _computator2.default,_globalConfig2.default.analytics&&(this.analytics=new _analytics2.default,this.recommendationsListener=new _recommendationsListener2.default(this.analytics),this.eventsHandler=new _eventsHandler2.default(this.analytics)),this.cnfgBackup={},
"function"==typeof eval(_globalConfig2.default.onpluginload)||_globalConfig2.default.iframed||_logger.logger.error("onpluginload param function expected. \n                Got ["+_typeof(eval(_globalConfig2.default.onpluginload))+"] "+_globalConfig2.default.onpluginload+"\n                Execution of the plugin will continue without calling onpluginload."),""===_globalConfig2.default.domain){var hostname=location.hostname.split(".");_globalConfig2.default.domain=hostname[hostname.length-2]||""}_globalConfig2.default.disablestorage&&(_logger.logger.warn("Storage is disabled, you have been warned."),_localStorage.ls.disableLocalStorage(),_sessionStorage.ss.disableSessionStorage(),_globalConfig2.default.sharedls=!1),_globalConfig2.default.sharedls?(this.createIframe(),document.addEventListener("messenger",function(e){try{e.detail.message}catch(e){return!1}var message=e.detail.message;if("iframe loaded"===message)_this2.iframeLoaded=!0,_this2.messenger.sendPost({action:"getViewedVideos"});else if("videoViews"===message.content){var viewedVids=_localStorage.ls.get("vx_viewed")||[];message.views.forEach(function(e){viewedVids.forEach(function(t){e!==t&&(message.views.push(t),_this2.messenger.sendPost({action:"saveNewVideoView",url:t}))})}),_localStorage.ls.set("vx_viewed",message.views),_localStorage.ls.set("vx_recommended",message.recommended),"function"==typeof eval(_globalConfig2.default.onpluginload)&&eval(_globalConfig2.default.onpluginload)(),_logger.logger.info("Vilynx Recommendator initialized successful for domain "+_globalConfig2.default.domain+".")}})):setTimeout(function(){"function"==typeof eval(_globalConfig2.default.onpluginload)&&eval(_globalConfig2.default.onpluginload)()},5)}},{key:"get",value:function(e,t,n){var o=this;_globalConfig2.default.excludeRelated=!1,_globalConfig2.default.excludeTrending=!1,_globalConfig2.default.excludeMostViewed=!1,this.restoreConfig(),n&&this.loadTempConfig(n);var i=_localStorage.ls.get("vx_viewed")||[],r=_localStorage.ls.get("vx_computed")||{},a=_localStorage.ls.get("vx_parentVideos")||{},s=_localStorage.ls.get("vx_recommended")||{},l=void 0,u=[],c=[],d={};if(_globalConfig2.default.disablecf?(_logger.logger.info('Collaborative filter is disable due "disablecf"'),_globalConfig2.default.cf=!1):0===i.length?(_logger.logger.info("Activating Collaborative Filter"),_globalConfig2.default.cf=!0):_globalConfig2.default.cf&&(_logger.logger.info("Deactivating Collaborative Filter"),_recommendationsFinder.recommendationFinder.destructor(),_globalConfig2.default.cf=!1),0===e.indexOf("//")&&(e=e.replace("//","")),_logger.logger.log("Getting recommendations for: "+e),_globalConfig2.default.currenturl=e,l=e.replace(_privateConfig2.default.cleanUrlRegex,""),_globalConfig2.default.urlsplitchar){var f=l.split(_globalConfig2.default.urlsplitchar);l=f[f.length-1]}if(_sessionStorage.ss.remove("vx_lastBatchRecommended"),_globalConfig2.default.sharedls&&this.messenger&&this.messenger.sendPost({action:"saveNewVideoView",url:l}),r[l]&&(_logger.logger.log("Removing "+l+" from user profile."),delete r[l]),-1===i.indexOf(l)&&l.length>0){if(i.push(l),Object.keys(i).length>_globalConfig2.default.viewedMaxSize){var g=Object.keys(i).length-_globalConfig2.default.viewedMaxSize;i.splice(0,g)}_localStorage.ls.set("vx_viewed",i)}Object.keys(a).forEach(function(e){var t=new Date,n=a[e][1];Math.abs(t-n)/36e5>_globalConfig2.default.userprofilettl&&(_logger.logger.log("ParentVideos: Parent video "+a[e][0]+" has timed out."),a[e][1]=(new Date).getTime(),u.push(e),c.push(a[e][0]),d[a[e][0]]=e)}),Object.keys(r).forEach(function(e){u.indexOf(r[e][2])>-1&&(_logger.logger.info("ParentVideos: Removing "+e+" from user profile for relation with "+a[r[e][2]][0]),delete r[e])}),_localStorage.ls.set("vx_computed",r),_localStorage.ls.set("vx_recommended",s),_localStorage.ls.set("vx_parentVideos",a),this.computador.getDataFromRemote(c,d,function(e){_globalConfig2.default.analytics&&(_globalConfig2.default.recommendationscontainer?o.recommendationsListener.listenToNode(_globalConfig2.default.recommendationscontainer):_logger.logger.error("When using analytics, you need to configure the recommendationscontainer in order tolisten to them."),o.eventsHandler.addRecommendationsToTrack(e)),t(e)})}},{key:"getTrending",value:function(e,t){_globalConfig2.default.excludeRelated=!0,_globalConfig2.default.excludeTrending=!1,_globalConfig2.default.excludeMostViewed=!0,this.restoreConfig(),t&&this.loadTempConfig(t);var n=_localStorage.ls.get("vx_videosScored")||{};return _globalConfig2.default.debug||(_globalConfig2.default.debug=_localStorage.ls.get("vilynx_results")||!1),_logger.logger.log("Getting trending."),_globalConfig2.default.currenturl="",_localStorage.ls.remove("vx_videosScored"),_localStorage.ls.remove("vx_videos"),this.computador.getDataFromRemote(n,e)}},{key:"getMostViewed",value:function(e,t){_globalConfig2.default.excludeRelated=!0,_globalConfig2.default.excludeTrending=!0,_globalConfig2.default.excludeMostViewed=!1;var n=_localStorage.ls.get("vx_videosScored")||{};return this.restoreConfig(),t&&this.loadTempConfig(t),_globalConfig2.default.debug||(_globalConfig2.default.debug=_localStorage.ls.get("vilynx_results")||!1),_logger.logger.log("Getting trending."),_globalConfig2.default.currenturl="",_localStorage.ls.remove("vx_videosScored"),_localStorage.ls.remove("vx_videos"),this.computador.getDataFromRemote(n,e)}},{key:"getTrendingAndMostViewed",value:function(e,t){_globalConfig2.default.excludeRelated=!0,_globalConfig2.default.excludeTrending=!1,_globalConfig2.default.excludeMostViewed=!1;var n=_localStorage.ls.get("vx_videosScored")||{};return this.restoreConfig(),t&&this.loadTempConfig(t),_globalConfig2.default.debug||(_globalConfig2.default.debug=_localStorage.ls.get("vilynx_results")||!1),_logger.logger.log("Getting trending."),_globalConfig2.default.currenturl="",_localStorage.ls.remove("vx_videosScored"),_localStorage.ls.remove("vx_videos"),this.computador.getDataFromRemote(n,e)}},{key:"insert",value:function(e,t,n){var o=this;n?n.returnmetadata=!0:n={returnmetadata:!0},this.get(e,function(e,n,i){o.vidHTML=new _vidhtml2.default(t),o.vidHTML.insertRecommendations(e,i)},n)}},{key:"loadGlobalConfig",value:function(){var e=document.querySelector('script[src*="vilynx.com/vidrec/vidrec"], script[data-vidrec-local]');return e?(Object.keys(e.attributes).forEach(function(t){var n=e.attributes[t];if("data-"===n.name.substr(0,5)){var o=n.name.replace("data-","");void 0===_globalConfig2.default[o]?_logger.logger.warn("Config register not found: "+n.name):(_globalConfig2.default[o]=n.value,_logger.logger.debug("Config element loaded: "+n.name))}}),_globalConfig2.default.userid||_globalConfig2.default.publickey?(_globalConfig2.default.publickey&&(_globalConfig2.default.userid=_globalConfig2.default.publickey),_globalConfig2.default.domainpercentage&&(_globalConfig2.default.percentedomairecommend=_globalConfig2.default.domainpercentage),_logger.logger.info("Config loaded"),_globalConfig2.default.loaded=!0,!0):(_logger.logger.error("FUBAR: Can't find userid. Aborting"),!1)):(_logger.logger.warn("Vilynx Script not detected"),!1)}},{key:"loadTempConfig",value:function(e){var t=this;return this.cnfgBackup={},e?(_logger.logger.info("Loading options object"),Object.keys(e).forEach(function(n){void 0===_globalConfig2.default[n]?_logger.logger.warn("Config register not found: "+n):(t.cnfgBackup[n]=_globalConfig2.default[n],_globalConfig2.default[n]=e[n],_logger.logger.debug("Config element loaded: "+n))}),_globalConfig2.default.domainpercentage&&(_globalConfig2.default.percentedomairecommend=_globalConfig2.default.domainpercentage),_logger.logger.info("Config loaded"),!0):(_logger.logger.warn("No options to load"),!1)}},{key:"restoreConfig",value:function(){var e=this;Object.keys(this.cnfgBackup).forEach(function(t){void 0===_globalConfig2.default[t]?_logger.logger.warn("Config register not found: "+t):(_globalConfig2.default[t]=e.cnfgBackup[t],_logger.logger.debug("Config element restored: "+t))}),this.cnfgBackup={}}},{key:"createIframe",value:function(){var e=this,t="",n=document.createElement("iframe"),o=_privateConfig2.default.version;return t="dev"===o?_privateConfig2.default.cndUrl+"/shvivi.html":_privateConfig2.default.cndUrl+"/shvivi."+o+".html",n.setAttribute("height","0px"),n.setAttribute("width","0px"),n.setAttribute("width","0px"),n.style.display="none",n.setAttribute("name","vilynxVrSup"),n.src=t,n.id="vilynxVrSup",n.onload=function(){e.messenger=new _messenger2.default("top");var t="";t="dev"===o?"shvivi.js":"shvivi."+o+".min.js",e.messenger.sendPost({vidrecInit:!0,vidrecSrc:t,config:_globalConfig2.default})},document.body.appendChild(n),!0}}]),Recommendator}();window.vilynxRecommendations=new Recommendator},{"./config/globalConfig":37,"./config/privateConfig":38,"./modules/analytics/analytics":40,"./modules/analytics/eventsHandler":42,"./modules/analytics/recommendationsListener":43,"./modules/computator":44,"./modules/helpers/comm/internal/messenger":48,"./modules/helpers/dom/recommendationsFinder":49,"./modules/helpers/dom/scrollMonitor":50,"./modules/helpers/storage/localStorage":51,"./modules/helpers/storage/localStorageUpdater":52,"./modules/helpers/storage/sessionStorage":53,"./modules/helpers/utils/logger":54,"./modules/vidhtml":55,"./polyfills/classList":56,"./polyfills/customEvent":57,"./polyfills/mutationObserver":58,"./polyfills/path":59}],40:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./dagdaSingleton"),a=function(e){return e&&e.__esModule?e:{default:e}}(r),s=e("@vilynx/dagda/src/dagda/enums/reco"),l=e("../helpers/utils/logger"),u=function(){function e(){o(this,e),this.dagda=a.default.instance()}return i(e,[{key:"trackRecommendationClick",value:function(e){l.logger.info("Tracking recommendation click for element with id "+e),this.dagda.recoTrack({eventType:s.RecoEvents.click,eventTime:+new Date,elemHash:e})}}]),e}();n.default=u},{"../helpers/utils/logger":54,"./dagdaSingleton":41,"@vilynx/dagda/src/dagda/enums/reco":15}],41:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=e("../../config/globalConfig"),s=o(a),l=e("../../config/privateConfig"),u=o(l),c=e("@vilynx/dagda/src/Dagda"),d=o(c),f=e("@vilynx/frontend-core/enums/logger"),g=function(){function e(){i(this,e)}return r(e,null,[{key:"instance",value:function(){var e=s.default.debug?f.LogLevel.develop:f.LogLevel.nope;return s.default.analytics&&!this._dagda&&(this._dagda=new d.default({pluginName:"vidrec",pluginVersion:u.default.version},{publicKey:s.default.publickey,logLevel:e})),this._dagda}}]),e}();n.default=g},{"../../config/globalConfig":37,"../../config/privateConfig":38,"@vilynx/dagda/src/Dagda":1,"@vilynx/frontend-core/enums/logger":30}],42:[function(e,t,n){"use strict";function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=e("../helpers/utils/logger"),s=function(){function e(t){var n=this;i(this,e),this.analytics=t,this.trackedHashes=new Set,addEventListener("gallery_event",function(e){n.processMessage(e)})}return r(e,[{key:"addRecommendationsToTrack",value:function(e){var t=e.map(function(e){return e.hash});this.trackedHashes=new Set([].concat(o(this.trackedHashes),o(t)))}},{key:"processMessage",value:function(e){var t=e.detail.hash;a.logger.debug("Received new hash from CustomEvent "+t),this.trackedHashes.has(t)&&(this.analytics.trackRecommendationClick(t),a.logger.debug(t))}}]),e}();n.default=s},{"../helpers/utils/logger":54}],43:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("../helpers/utils/logger"),a=e("../../config/privateConfig"),s=function(e){return e&&e.__esModule?e:{default:e}}(a),l=function(){function e(t){o(this,e),this.analytics=t,this.retries=0}return i(e,[{key:"listenToNode",value:function(e){var t=this;this.checkInterval=window.setInterval(function(){var n=document.querySelector(e),o={childList:!0,subtree:!0};t.retries+=1,t.retries===s.default.maxRetries&&(r.logger.error("The selected node for recommendations could not be found after 100 retries.Please check the selector"),window.clearInterval(t.checkInterval)),n&&(window.clearInterval(t.checkInterval),t.nodeObserver=new MutationObserver(function(e){e.forEach(function(e){t._addRecommendationClickListenerToNode(e.target)})}),t._addRecommendationClickListenerToNode(n),t.nodeObserver.observe(n,o))},500)}},{key:"_addRecommendationClickListenerToNode",value:function(e){var t=this;e.querySelectorAll("[data-vilynx-recommendation-id]").forEach(function(e){if(!e.dataset.vilynxRecommendationListened){var n=e.dataset.vilynxRecommendationId;e.dataset.vilynxRecommendationListened="true",e.addEventListener("click",function(){t.analytics.trackRecommendationClick(n),r.logger.info("Clicked recommendation with hash "+n+" on node: "+e)})}})}}]),e}();n.default=l},{"../../config/privateConfig":38,"../helpers/utils/logger":54}],44:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=e("../config/globalConfig"),s=o(a),l=e("../config/privateConfig"),u=o(l),c=e("./helpers/comm/external/emergencyService"),d=o(c),f=e("./helpers/comm/external/xhr"),g=o(f),v=e("./helpers/comm/internal/messenger"),h=o(v),p=e("./helpers/dom/recommendationsFinder"),m=e("./helpers/storage/localStorage"),y=e("./helpers/storage/sessionStorage"),_=e("./helpers/utils/logger"),b=function(){function e(){i(this,e),this.xhr=new g.default,this.emeregency=new d.default,this.config={},this.r={},this.computed={},this.userProfile={},this.computedFinal={},this.debugReturn={},this.domainExclusiveVideos=0,this.domainExclusiveTrends=0,this.domainExclusiveViews=0}return r(e,[{key:"getDataFromRemote",value:function(e,t,n){var o=this,i=void 0,r=u.default.serverurl+"/api3.0/recommendations/plugin",a=void 0;if(e.length>0?e.unshift(s.default.currenturl):e=[s.default.currenturl],e=JSON.stringify(e),s.default.confighash)i={public_key:s.default.userid,ids:e},r+="/"+s.default.confighash,"preview"===s.default.confighash&&(i.rules_values_pcs=s.default.temprules);else{var l=[];l=s.default.onlyrelated?["related"]:["related","trending","views"],i={ids:e,public_key:s.default.userid,recommendation_types:JSON.stringify(l)}}i.related_limit=s.default.maxapirel,i.trends_limit=s.default.maxapitrend,i.views_limit=s.default.maxapiviews,i.return_guid=s.default.retrieveguid,i.cf=s.default.cf,i.get_content_info=s.default.returnmetadata,null!==s.default.dynamicFilter?i.dynamic_filter=JSON.stringify(s.default.dynamicFilter):"3605a9efe6e7514f3cb479dfb023cf4c"===s.default.userid&&(i.dynamic_filter=JSON.stringify({max_days:{values:5},recommendation_types:{values:["related","trending"]},url_filter_regex:{values:"[0-9]*",op:"equals"}})),s.default.cf&&(i.cf=!0,i.origin_url=document.location.host+(document.location.pathname||"")),a=m.ls.get("vx_config")||{},a.guid!==s.default.retrieveguid&&(a.guid=s.default.retrieveguid,_.logger.warn("ExtIds mismatch, updating config, removing user profile"),m.ls.set("vx_computed",{}),m.ls.set("vx_urlInfo",{}),m.ls.set("vx_recommended",{}),m.ls.set("vx_config",a)),this.xhr.get(r,i,function(i){o.handleOkResponse(i,e,t,n)},function(i){i&&o.handleKoResponse(e,t,n)})}},{key:"handleOkResponse",value:function(e,t,n,o){e=this.setEmptyResponseFields(e),this.doLoop(e,t,n,o)}},{key:"handleKoResponse",value:function(e,t,n){var o=this;_.logger.warn("API call fallback, using emergency service."),this.emeregency.getCdnJson(function(i){i=o.setEmptyResponseFields(i),o.doLoop(i,e,t,n)})}},{key:"setEmptyResponseFields",value:function(e){return e.related=e.related||{},e.views=e.views||{},e.trending=e.trending||{},e.campaigns=e.campaigns||{},e.config=e.config||{alpha:1,beta:.1,delta:1,gamma:.8},e}},{key:"doLoop",value:function(e,t,n,o){var i=this,r=[],a={},l=m.ls.get("vx_viewed")||[],c={},d=m.ls.get("vx_recommended")||{},f=s.default.currenturl.trim().replace(u.default.cleanUrlRegex,""),g=void 0,v="vx_computed",b=void 0,w=void 0,E=void 0,S=void 0,x=e.campaigns,C=[],k=[];if(s.default.confighash&&(v+="_"+s.default.confighash),this.userProfile=m.ls.get(v)||{},this.parentVideos=m.ls.get("vx_parentVideos")||{},e.info&&Object.keys(e.info).forEach(function(t){var n=t;if(s.default.urlsplitchar){var o=t.split(s.default.urlsplitchar);n=o[o.length-1]}a[n]=e.info[t]}),b=m.ls.get("vx_urlInfo")||{},Object.keys(b).forEach(function(e){a[e]=b[e]}),this.urlInfo=a,Object.keys(d).forEach(function(e){c[e]=1===d[e][0]||!1,d[e]=d[e][1]}),t=JSON.parse(t),this.userProfileVideoInfo={},this.config={},this.userProfileTimes={},this.userProfileParentVideo={},this.computed={},this.r=e,this.computedFinal={},this.debugReturn={},this.config.alpha=e.config.alpha,this.config.beta=e.config.beta,this.config.gamma=e.config.gamma,this.config.delta=e.config.delta,this.calculatePromotions(),this.unzipUserProfile(),l.forEach(function(e){d[e]&&delete d[e]}),s.default.excludeRelated||Object.keys(this.r.related).forEach(function(e){i.r.related[e].requested_id===f?(i.computed[e]=i.config.alpha*(i.r.related[e].related_score||0),s.default.debug&&(i.debugReturn[e]={user_profile_score:i.userProfile[e]||0,related_score:i.r.related[e].related_score||0,tScore:i.r.related[e].trending_score||0,most_viewed:i.r.related[e].views_score||0})):t.indexOf(i.r.related[e].requested_id)>0&&(_.logger.log("ParentVideos: Related coming from a old parent video "),1==n[i.r.related[e].requested_id]?(_.logger.info("ParentVideos:  Using this.config.gamma^2 for "+e),i.computed[e]=Math.pow(i.config.gamma,2)*(i.r.related[e].related_score||0)):2==n[i.r.related[e].requested_id]?(_.logger.info("ParentVideos:  Using this.config.gamma^3 for "+e),i.computed[e]=Math.pow(i.config.gamma,3)*(i.r.related[e].related_score||0)):_.logger.warn("Something went wrong")),i.computedFinal[e]=i.computed[e]+i.config.beta*(i.r.related[e].trending_score||0),i.r.related[e].views_score&&(i.computedFinal[e]+=i.config.delta*i.r.related[e].views_score),s.default.onlyrelated||(i.r.trending&&i.r.trending[e]&&delete i.r.trending[e],i.r.views&&i.r.views[e]&&delete i.r.views[e])}),this.loopUserProfile(),s.default.onlyrelated||(e.trending&&!s.default.excludeTrending&&this.loopTrending(),e.views&&!s.default.excludeMostViewed&&this.loopMost_viewed()),Object.keys(this.computedFinal).forEach(function(e){var t=e.split(s.default.urlsplitchar);if(t=t[t.length-1],d[t]&&d[t]>0&&d[t]<4){var n=.75;c[t]&&(n=.25),d[t]&&(i.computedFinal[e]*=Math.pow(n,d[t])),_.logger.info("Decreased score for "+e+" *("+n+"^"+d[t]+")  ")}}),s.default.cf&&this.r.cf&&(s.default.cfwo?_.logger.log("CF is in WO mode, ignoring input data"):Object.keys(this.computedFinal).forEach(function(e){i.r.cf[e]&&(i.computedFinal[e]*=i.r.cf[e])})),r=Object.keys(this.computedFinal).sort(function(e,t){return i.computedFinal[t]-i.computedFinal[e]}),l.forEach(function(t){var n=t.trim().replace(u.default.cleanUrlRegex,"");if(s.default.urlsplitchar){var o=n.split(s.default.urlsplitchar);n=o[o.length-1]}for(var a=0;a<r.length;a++)n&&r[a].indexOf(n)>-1&&r.length>s.default.limit&&(_.logger.info("Removing "+r[a]+" from url. Reason: Matching with "+n),r.splice(a,1),k.push(n));Object.keys(e.related).forEach(function(e){""!==n&&e.indexOf(n)>-1&&-1!==k.indexOf(n)&&(delete i.computed[e],_.logger.log("Removing "+e+" from user profile, matching with "+n))})}),k.forEach(function(e){var t=l.indexOf(e);l.push(l.splice(t,1)[0])}),m.ls.set("vx_viewed",l),w={},Object.keys(d).forEach(function(e){for(var t=0;t<r.length;t++)""!==e&&r[t].indexOf(e)>-1&&d[e]>=s.default.userProfileMaxRecommendations&&(w[e]=d[e])}),r.length-Object.keys(w).length<s.default.limit){var O=void 0;_.logger.warn("To many urls to remove, restoring old recommended urls. Restoring "+s.default.limit+" videos"),O=Object.keys(w).sort(function(e,t){return w[t]-w[e]}),O=O.splice(0,s.default.limit),O.forEach(function(e){d[e]=0})}if(Object.keys(d).forEach(function(e){for(var t=0;t<r.length;t++)""!==e&&r[t].indexOf(e)>-1&&d[e]>=s.default.userProfileMaxRecommendations&&(_.logger.info("Removing "+r[t]+" from url. Reason: Matching with "+e+" and already recommended "+s.default.userProfileMaxRecommendations+" times"),r.splice(t,1),d[e]+=1)}),this.limitUserProfile(),this.domainExclusiveVideos>0&&(r=this.promote(r)),r=r.slice(0,s.default.limit),r.forEach(function(e){var t=e.trim().replace(u.default.cleanUrlRegex,"");if(s.default.urlsplitchar){var n=t.split(s.default.urlsplitchar);t=n[n.length-1]}d[t]?d[t]+=1:d[t]=1}),Object.keys(d).length>s.default.viewedMaxSize){var T=void 0,P=void 0,M=Object.keys(d).length-s.default.viewedMaxSize;P=Object.keys(d).sort(function(e,t){return i.computed[t]-i.computed[e]}),T=P.splice(0,M-1),T.forEach(function(e){_.logger.debug("Removing "+e+" from all recommended, score too high"),delete d[e]})}if(s.default.currenturl.replace(u.default.cleanUrlRegex,"").length>0&&this.adminAndSaveTtl(d),Object.keys(d).forEach(function(e){var t=1;t=void 0!==c[e]&&c[e]?1:0,d[e]=[t,d[e]]}),m.ls.set("vx_recommended",d),E=[],E=Object.keys(this.computed).map(function(e){var t=e.split(s.default.urlsplitchar);return t[t.length-1]}),E=E.concat(r.map(function(e){var t=e.split(s.default.urlsplitchar);return t[t.length-1]})),Object.keys(a).forEach(function(e){-1===E.indexOf(e)&&(_.logger.debug("Removing "+e+" from vx_urlInfo, not present on computed anymore"),delete a[e])}),m.ls.set("vx_urlInfo",a),this.zipUserProfile(r),m.ls.set(v,this.computed),s.default.debug&&m.ls.set("vx_last_returned",{date:new Date,returned:r,debug:this.debugReturn}),s.default.sharedls){new h.default("top").sendPost({action:"saveAllRecommended",recommended:d})}if(S=r,s.default.urlsplitchar&&(S=[],r.forEach(function(e){var t=e.split(s.default.urlsplitchar);e=t[t.length-1],S.push(e)})),y.ss.set("vx_lastBatchRecommended",S),s.default.cf&&p.recommendationFinder.addUrlsToObserve(S),x&&Object.keys(x).forEach(function(e){var t=x[e].audience_pct;if(Math.floor(100*Math.random())+1<=t){var n=void 0;if(Object.keys(x[e].elements).some(function(t){var o=x[e].elements[t].guid;return-1===l.indexOf(o)&&(s.default.returnmetadata?(n=x[e].elements[t],n.thumbnail_url?(n.thumbnail=n.thumbnail_url,delete n.thumbnail_url):(n.thumbnail=null,delete n.thumbnail_url)):n=t,!0)}),!n){var o=Object.keys(x[e].elements).length,i=Math.floor(Math.random()*o),r=Object.keys(x[e].elements)[i];n=s.default.returnmetadata?x[e].elements[r]:r}n&&C.push(n)}}),g=r,s.default.returnmetadata){var L=[],I=0;r.forEach(function(t){var n=t.split(s.default.urlsplitchar);if(n=n[n.length-1],a[n]&&a[n].title){var o=Object.assign(a[n],{score:i.computedFinal[t]||0});o.thumbnail_url?(o.thumbnail=o.thumbnail_url,delete o.thumbnail_url):(o.thumbnail=null,delete o.thumbnail_url),L.push(o),s.default.displayallscores&&(e.related[n]?L[I].scores={trend_score:e.related[n].trending_score||0,related_score:e.related[n].related_score||0,user_profile_score:i.userProfile[n]||0,view_score:e.related[n].views_score||0}:L[I].scores={trend_score:e.trending[n]||0,related_score:0,user_profile_score:i.userProfile[n]||0,view_score:e.views[n]||0}),I+=1}else _.logger.warn("Missing "+t+' on "vx_urlInfo". Result will not be returned.')}),C.forEach(function(e){e.score=0,L.unshift(e)}),g=L.splice(0,s.default.limit)}else C.forEach(function(e){g.unshift(e)});return o(g,this.debugReturn,e.info)}},{key:"unzipUserProfile",value:function(){var e=this;Object.keys(this.userProfile).forEach(function(t){var n=t.split(s.default.urlsplitchar);n=n[n.length-1],void 0===e.urlInfo[n]?_.logger.warn(t+" Missing on urlInfo. Excluding."):(e.userProfileTimes[t]=e.userProfile[t][1],e.userProfileParentVideo[t]=e.userProfile[t][2],e.userProfile[t]=e.userProfile[t][0])})}},{key:"zipUserProfile",value:function(e){var t=this;Object.keys(this.computed).forEach(function(n){if(t.userProfileTimes[n]?t.computed[n]=[t.computed[n],t.userProfileTimes[n]]:t.computed[n]=[t.computed[n],0],-1!==e.indexOf(n)&&(t.computed[n][1]+=1),t.r.related[n]){var o=0;Object.keys(t.parentVideos).forEach(function(e){t.parentVideos[e]&&t.parentVideos[e][0]===t.r.related[n].requested_id&&(o=e)}),o||(o=0),t.computed[n][2]=o}else t.computed[n][2]=t.userProfileParentVideo[n];t.computed[n][1]>=s.default.userProfileMaxRecommendations&&(_.logger.debug("Removing "+n+" from user profile, recommended to many times"),delete t.computed[n])})}},{key:"loopUserProfile",value:function(){var e=this;Object.keys(this.userProfile).forEach(function(t){return e.computedFinal[t]?e.computedFinal[t]+=e.config.gamma*e.userProfile[t]:e.computedFinal[t]=e.config.gamma*e.userProfile[t],e.computed[t]?e.computed[t]+=e.config.gamma*e.userProfile[t]:e.computed[t]=e.config.gamma*e.userProfile[t],!0})}},{key:"loopTrending",value:function(){var e=this;_.logger.debug("Iterating Trending data"),Object.keys(this.r.trending).forEach(function(t){e.computedFinal[t]?e.computedFinal[t]+=e.config.beta*e.r.trending[t]:e.computedFinal[t]=e.config.beta*e.r.trending[t],s.default.debug&&(e.debugReturn[t]?e.debugReturn[t].trending_score=e.r.trending[t]:e.debugReturn[t]={tScore:e.r.trending[t]})})}},{key:"loopMost_viewed",value:function(){var e=this;_.logger.debug("Iterating Most viewed data"),Object.keys(this.r.views).forEach(function(t){e.computedFinal[t]?e.computedFinal[t]+=e.config.delta*e.r.views[t]:e.computedFinal[t]=e.config.delta*e.r.views[t],s.default.debug&&(e.debugReturn[t]?e.debugReturn[t].most_viewed=e.r.views[t]:e.debugReturn[t]={most_viewed:e.r.views[t]})})}},{key:"calculatePromotions",value:function(){0===Object.keys(this.userProfile).length&&0===Object.keys(this.r.related).length&&(this.r.views||this.r.trending)&&(_.logger.info("No user profile and no related found. Generating extra weights for views and trend"),this.domainExclusiveVideos=Math.round(s.default.limit*s.default.percentedomairecommend),this.domainExclusiveTrends=Math.floor(Math.random()*this.domainExclusiveVideos),this.domainExclusiveViews=this.domainExclusiveVideos-this.domainExclusiveTrends,this.domainExclusiveViews>Object.keys(this.r.views)&&(this.domainExclusiveTrends+=-(Object.keys(this.r.views)-this.domainExclusiveViews),this.domainExclusiveViews-=-(Object.keys(this.r.views)-this.domainExclusiveViews)),_.logger.info("News promotions will be for: \n                Trend "+this.domainExclusiveTrends+" \n                Views "+this.domainExclusiveViews))}},{key:"promote",value:function(e){for(var t=this,n=0,o=0,i=0;i<s.default.limit;i++)e[i]&&-1!==e[i].indexOf(s.default.domain)&&(this.domainExclusiveVideos-=1);return this.domainExclusiveVideos<0?(_.logger.info("No promotions are needed, the pole is set."),e):(this.calculatePromotions(),this.r&&this.r.trending?Object.keys(this.r.trending).forEach(function(o){if(n<t.domainExclusiveTrends){var i=e.indexOf(o);if(-1!==o.indexOf(s.default.domain)&&-1!==i){if(i>s.default.limit){var r=e.splice(i,1)[0];e.splice(n,0,r),_.logger.info("Promoted "+r+" from trends. From position "+i+" to "+n)}n+=1}}}):_.logger.warn("There is no trending for promotion :( "),this.r&&this.r.views?Object.keys(this.r.views).forEach(function(n){var i=e.indexOf(n);if(n.indexOf(s.default.domain)>=0&&o<=t.domainExclusiveViews&&-1!==i){var r=e.splice(i,1)[0];e.unshift(r),_.logger.info("Promoted "+r+" from views. From position "+i+" to "+o),o+=1}}):_.logger.warn("There is no views for promotion :( "),e)}},{key:"limitUserProfile",value:function(){var e=this;if(Object.keys(this.computed).length>s.default.userProfileMaxSize){var t=void 0,n=void 0,o=Object.keys(this.computed).length-s.default.userProfileMaxSize;n=Object.keys(this.computed).sort(function(t,n){return e.computed[t]-e.computed[n]}),t=n.splice(0,o-1),t.forEach(function(t){_.logger.debug("Removing "+t+" from user profile, score too low"),delete e.computed[t]})}}},{key:"adminAndSaveTtl",value:function(e){var t=this,n=!1,o=s.default.currenturl.replace(u.default.cleanUrlRegex,"");if(Object.keys(this.parentVideos).forEach(function(e){t.parentVideos[e][0]===o&&(n=e)}),n){if(_.logger.log("ParentVideos: Parent video already have used slot, updating timestamp"),2==n){var i=this.parentVideos[1];this.parentVideos[1]=this.parentVideos[2],this.parentVideos[2]=i,Object.keys(this.userProfileVideoInfo).forEach(function(e){2==t.userProfileVideoInfo[e]?t.userProfileVideoInfo[e]="1":1==t.userProfileVideoInfo[e]&&(t.userProfileVideoInfo[e]="2")})}this.parentVideos[1][1]=(new Date).getTime()}else Object.keys(this.userProfileParentVideo).forEach(function(e){2==t.userProfileParentVideo[e]?delete t.computed[e]:1==t.userProfileParentVideo[e]&&(t.userProfileParentVideo[e]="2")}),this.parentVideos[2]=this.parentVideos[1],this.parentVideos[1]=[o,(new Date).getTime()];Object.keys(this.parentVideos).forEach(function(n){Object.keys(e).forEach(function(e){t.userProfileParentVideo[e]==n&&(_.logger.log("ParentVideos: Found a recommended video with a parent on the dict, updating timestamp"),t.parentVideos[n][1]=(new Date).getTime())})}),m.ls.set("vx_parentVideos",this.parentVideos)}}]),e}();n.default=b},{"../config/globalConfig":37,"../config/privateConfig":38,"./helpers/comm/external/emergencyService":45,"./helpers/comm/external/xhr":46,"./helpers/comm/internal/messenger":48,"./helpers/dom/recommendationsFinder":49,"./helpers/storage/localStorage":51,"./helpers/storage/sessionStorage":53,"./helpers/utils/logger":54}],45:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=e("./xhr"),s=o(a),l=e("../../../../config/globalConfig"),u=o(l),c=e("../../../../config/privateConfig"),d=o(c),f=e("../../utils/logger"),g=function(){function e(){i(this,e),this.maxHourDelay=24,this.currentHourDelay=0,this.xhr=new s.default,this.cndUrl=d.default.publicUrl+"/recommendation/"}return r(e,[{key:"getCdnJson",value:function(e){f.logger.info("Starting emergency service"),this.currentHourDelay=0,this.doCall(e,this.getFormattedJsonUrl())}},{
key:"doCall",value:function(e,t){var n=this;this.xhr.get(t,"",function(o){f.logger.info("Got response on '"+t+"' with "+n.currentHourDelay+" hours of delay"),e(o)},function(){setTimeout(function(){n.currentHourDelay<n.maxHourDelay?(n.currentHourDelay+=1,n.doCall(e,n.getFormattedJsonUrl())):(f.logger.warn("CDN file not found, using user profile."),e(n.getLocalJson()))},5)})}},{key:"getLocalJson",value:function(){return{config:{alpha:1,beta:1,delta:1,gamma:.8},most_viewed:{},rel:{},trend:{}}}},{key:"getFormattedJsonUrl",value:function(){var e=new Date,t="",n=void 0,o=void 0,i=void 0,r=void 0;return e=new Date(e.setHours(e.getHours()-this.currentHourDelay)),o=e.getUTCMonth()+1,i=e.getUTCHours(),r=e.getUTCDate(),u.default.confighash&&(t="_"+u.default.confighash),o<10&&(o="0"+o),r<10&&(r="0"+r),i<10&&(i="0"+i),n=u.default.userid+"_"+e.getUTCFullYear()+o+r+"_"+i+t+".json",this.cndUrl+n}}]),e}();n.default=g},{"../../../../config/globalConfig":37,"../../../../config/privateConfig":38,"../../utils/logger":54,"./xhr":46}],46:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("../../utils/logger"),a=function(){function e(){o(this,e)}return i(e,[{key:"get",value:function(e,t,n,o){r.logger.info("Making Xhr GET to "+e);var i=new XMLHttpRequest,a=Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&");i.open("GET",e+"?"+a,!0),i.setRequestHeader("Accept","application/json, text/javascript, */*"),i.onreadystatechange=function(){4!==i.readyState||"2"!==i.status.toString()[0]&&"0"!==i.status.toString()[0]?4===i.readyState&&"2"!==i.status.toString()[0]&&(r.logger.error("Xhr GET to "+e+" erroneous with code "+i.status),o("5"===i.status.toString()[0]?!0:!1)):(r.logger.info("Xhr GET to "+e+" successful with code "+i.status),i.response.length>1?n(JSON.parse(i.response)):(r.logger.warn("No JSON data found on the response"),o(!1)))},i.send(null)}},{key:"post",value:function(e,t,n,o){r.logger.info("Making Xhr Post to "+e);var i=new XMLHttpRequest,a=Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&");i.open("POST",e+"?"+a,!0,!0),i.setRequestHeader("Accept","application/json, text/javascript, */*"),i.onreadystatechange=function(){4===i.readyState&&"2"===i.status.toString()[0]?(r.logger.info("Xhr Post to "+e+" successful with code "+i.status),i.response.length>1?n(JSON.parse(i.response)):(r.logger.warn("No JSON data found on the response"),o(!1))):4===i.readyState&&"2"!==i.status.toString()[0]&&(r.logger.error("Xhr Post to "+e+" erroneous with code "+i.status),o(!0))},i.send(null)}}]),e}();n.default=a},{"../../utils/logger":54}],47:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function e(t,n){o(this,e),this.timestamp=Date.now(),this.sender=n,this.message=t,this.isVidrecMessage=!0};n.default=i},{}],48:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./message"),a=function(e){return e&&e.__esModule?e:{default:e}}(r),s=e("../../utils/logger"),l=function(){function e(t){return o(this,e),this.role=t,this.chanel="messenger","top"===this.role?this.postDestination=document.querySelector("#vilynxVrSup").contentWindow:"iframe"===this.role?this.postDestination=parent.window:s.logger.warn("Role not defined properly, must define role ['top' or 'iframe'] to send post message"),this.listenPost(),!0}return i(e,[{key:"sendInternal",value:function(e,t){var n={};n=t?new CustomEvent(this.chanel,{detail:e}):new CustomEvent(this.chanel,{detail:new a.default(e,this.role)}),document.dispatchEvent(n)}},{key:"sendPost",value:function(e,t){s.logger.info("Sending post message:"),s.logger.info(e);var n={};if(n=t?e:new a.default(e,this.role),"top"!==this.role&&"iframe"!==this.role)return s.logger.warn("Role not defined properly, must define role ['top' or 'iframe'] to send post message"),!1;this.postDestination.postMessage(n,"*")}},{key:"listenPost",value:function(){var e=this;window.addEventListener("message",function(t){if(!t.data.isVidrecMessage)return!1;e.sendInternal(t.data,!0)})}}]),e}();n.default=l},{"../../utils/logger":54,"./message":47}],49:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.recommendationFinder=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=e("../../../config/privateConfig"),s=o(a),l=e("./../comm/external/xhr"),u=o(l),c=e("./../storage/sessionStorage"),d=e("./../storage/localStorage"),f=e("./../utils/logger");e("../../../polyfills/mutationObserver"),e("../../../polyfills/classList");var g=e("../../../config/globalConfig"),v=o(g),h=function(){function e(){var t=this;i(this,e),this.urlsToObserve=[],this.urlsObsrved=[],this.scrollWatchers=[],this.domNodes=[],this.currentElementsInDom=0,this.hashesToSend=[],this.xhr=new u.default,this.currentUrl=document.location.host+(document.location.pathname||""),"complete"===document.readyState||"interactive"===document.readyState?this.addDomObserver():document.addEventListener("DOMContentLoaded",function(){t.addDomObserver()})}return r(e,[{key:"destructor",value:function(){this.urlsToObserve=[],this.urlsObsrved=[],this.scrollWatchers=[],this.domNodes=[],this.currentElementsInDom=0,this.hashesToSend=[],this.domObserver&&this.domObserver.disconnect()}},{key:"addUrlsToObserve",value:function(e){var t=this;return"string"==typeof e&&(e=[e]),e.forEach(function(e){-1===t.urlsToObserve.indexOf(e)&&-1===t.urlsObsrved.indexOf(e)&&t.urlsToObserve.push(e)}),!0}},{key:"reScanDom",value:function(e){var t=this,n={},o=0;Array.prototype.forEach.call(e,function(e){e.querySelector&&t.urlsToObserve.forEach(function(o){try{if(-1===t.urlsObsrved.indexOf(o)){var i='a[href*="'+o+'"]:not(.vilynx_cf)',r=void 0;if(v.default.idattribute&&(i+=", *.vilynx_enabled["+v.default.idattribute+'*="'+o+'"]:not(.vilynx_cf)'),(r=e.querySelector(i))&&r.offsetParent)throw n[o]=r,o}}catch(n){var a=t.urlsToObserve.indexOf(n);t.urlsObsrved.push(t.urlsToObserve.slice(a,1)),f.logger.log(e),f.logger.log("found! "+n)}})}),Object.keys(n).length>0&&Object.keys(n).forEach(function(e){try{var i=void 0,r=void 0;try{i=n[e],r=i.classList.contains("vilynx_cf")}catch(e){r=!1}if(!r&&n[e]){var a=t.getHashFromUrl(e),l=t.scrollWatchers.push(window.scrollMonitor.create(i));try{i.classList.add("vilynx_cf")}catch(e){return f.logger.error(e),0}a.length>1?(t.scrollWatchers[l-1].enterViewport(function(){i.classList.contains("vilynx_cf_watched")||(f.logger.log(a+" entering viewport for first time"),i.classList.add("vilynx_cf_watched"),t.hashesToSend.push(a),t.currentElementsInDom+=1,t._debounce(function(){var e={data:JSON.stringify({currentUrl:t.currentUrl,hashes:t.hashesToSend,numVideos:t.currentElementsInDom})};t.xhr.get(s.default.serverurl+"/api2.0/recommendations/cf_displayed",e,function(){return t.hashesToSend=[],!0},function(){return!0})},500)())}),i.addEventListener("click",function(){var e={data:JSON.stringify({currentUrl:t.currentUrl,videoSelected:a,numVideos:t.currentElementsInDom})};c.ss.set("vx_clicked",e),setTimeout(function(){t.sendClickEvent(e)},500)},!0)):f.logger.warn("Video URL "+e+" have no associated hash")}else o+=1}catch(e){f.logger.error(e)}}),o>0&&this.reScanDom(e)}},{key:"addDomObserver",value:function(){var e=this,t=document.querySelector("body"),n={childList:!0,subtree:!0};this.domObserver=new MutationObserver(function(t){t.forEach(function(t){t.addedNodes.length>0&&e.reScanDom(t.addedNodes)})}),this.domObserver.observe(t,n)}},{key:"getHashFromUrl",value:function(e){var t=d.ls.get("vx_urlInfo");return!!t[e]&&t[e].hash}},{key:"sendClickEvent",value:function(e,t){this.xhr.get(s.default.serverurl+"/api2.0/recommendations/cf_clicked",e,function(){c.ss.remove("vx_clicked")},function(){f.logger.warn("Can't send clicked element."),t&&(f.logger.info("Removing information form SS."),c.ss.remove("vx_clicked"))})}},{key:"_debounce",value:function(e,t,n){var o=this,i=arguments;return v.default.cf?function(){var r=o,a=i,s=function(){o.timeout=null,n||e.apply(r,a)},l=n&&!o.timeout;clearTimeout(o.timeout),o.timeout=setTimeout(s,t),l&&e.apply(r,a)}:(f.logger.warn('"CF" is disabled, debounce is disabled.'),function(){return!1})}},{key:"_findAncestor",value:function(e,t){for(;(e=e.parentElement)&&!e.classList.contains(t););return e}}]),e}();n.recommendationFinder=new h},{"../../../config/globalConfig":37,"../../../config/privateConfig":38,"../../../polyfills/classList":56,"../../../polyfills/mutationObserver":58,"./../comm/external/xhr":46,"./../storage/localStorage":51,"./../storage/sessionStorage":53,"./../utils/logger":54}],50:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.scrollMonitor=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("../../../config/globalConfig"),a=function(e){return e&&e.__esModule?e:{default:e}}(r),s=e("./../utils/logger"),l=function(){function e(){var t=this;o(this,e);var n=setInterval(function(){a.default.loaded&&(s.logger.info("ScrollMonitor initialized"),window.scrollMonitor=t.factory(),clearInterval(n))},20)}return i(e,[{key:"factory",value:function(){function e(){if(d.viewportTop=u(),d.viewportBottom=d.viewportTop+d.viewportHeight,d.documentHeight=k(),d.viewportLeft=c(),d.viewportRight=d.viewportLeft+d.viewportWidth,d.documentWidth=O(),d.documentHeight!==T||d.documentWidth!==P){for(L=f.length;L--;)f[L].recalculateLocation();T=d.documentHeight,P=d.documentWidth}}function t(){d.viewportHeight=x(),d.viewportWidth=C(),e(),o()}function n(){clearTimeout(I),I=setTimeout(t,100)}function o(){for(j=f.length;j--;)f[j].recalculateLocation(),f[j].update();for(j=f.length;j--;)f[j].triggerCallbacks()}function i(e,t){function n(e){if(0!==e.length)for(f=e.length;f--;)x=e[f],x.callback.call(o,M),x.isOne&&e.splice(f,1)}var o=this;this.watchItem=e,this.offsets=t?t===+t?{top:t,bottom:t}:{top:t.top||S.top,bottom:t.bottom||S.bottom}:S,this.callbacks={};for(var i=0,r=E.length;i<r;i++)o.callbacks[E[i]]=[];this.locked=!1;var a,s,l,u,c,f,x,C=!0;this.triggerCallbacks=function(){switch(this.isInViewport&&!a&&n(this.callbacks[v]),this.isFullyInViewport&&!s&&n(this.callbacks[h]),this.isCanPreload&&!c&&n(this.callbacks[b]),this.isCanUnload&&!C&&n(this.callbacks[w]),this.isAboveViewport!==l&&this.isBelowViewport!==u&&(n(this.callbacks[g]),s||this.isFullyInViewport||(n(this.callbacks[h]),n(this.callbacks[m])),a||this.isInViewport||(n(this.callbacks[v]),n(this.callbacks[p]))),!this.isFullyInViewport&&s&&n(this.callbacks[m]),!this.isInViewport&&a&&n(this.callbacks[p]),this.isInViewport!==a&&n(this.callbacks[g]),!0){case a!==this.isInViewport:case s!==this.isFullyInViewport:case l!==this.isAboveViewport:case u!==this.isBelowViewport:n(this.callbacks[_])}a=this.isInViewport,s=this.isFullyInViewport,l=this.isAboveViewport,u=this.isBelowViewport,c=this.isCanPreload,C=this.isCanUnload},this.recalculateLocation=function(){if(!this.locked&&this.watchItem){var e=this.top,t=this.bottom;if(this.watchItem.nodeName){var o=this.watchItem.style.display;"none"===o&&(this.watchItem.style.display="");var i=this.watchItem.getBoundingClientRect();this.top=Math.ceil(i.top)+d.viewportTop,this.bottom=Math.floor(i.bottom)+d.viewportTop,this.left=Math.ceil(i.left)+d.viewportLeft,this.right=Math.floor(i.right)+d.viewportLeft,"none"===o&&(this.watchItem.style.display=o)}else this.watchItem===+this.watchItem?this.watchItem>0?this.top=this.bottom=this.watchItem:this.top=this.bottom=d.documentHeight-this.watchItem:(this.top=this.watchItem.top,this.bottom=this.watchItem.bottom);this.top-=this.offsets.top,this.bottom+=this.offsets.bottom,this.height=this.bottom-this.top,void 0===e&&void 0===t||this.top===e&&this.bottom===t||n(this.callbacks[y])}},this.recalculateLocation(),this.update(),a=this.isInViewport,s=this.isFullyInViewport,l=this.isAboveViewport,u=this.isBelowViewport}function r(t){M=t,e(),o()}this.version=.9;var s="undefined"==typeof window,l=!s,u=function(){return s?0:"undefined"!=typeof showMarquee?-parseInt(showMarquee.content.$container.css("top")):window.pageYOffset||document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop},c=function(){return s?0:window.pageXOffset>=0?0:window.pageXOffset||document.documentElement&&document.documentElement.scrollWidth||document.body.scrollWidth},d={},f=[],g="visibilityChange",v="enterViewport",h="fullyEnterViewport",p="exitViewport",m="partiallyExitViewport",y="locationChange",_="stateChange",b="canPreload",w="canUnload",E=[g,v,h,p,m,y,_,b,w],S={top:0,bottom:0},x=function(){return s?0:window.innerHeight||document.documentElement.clientHeight},C=function(){return s?0:window.innerWidth||document.documentElement.clientWidth},k=function(){return s?0:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight)},O=function(){return s?0:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth)};d.viewportTop=null,d.viewportBottom=null,d.documentHeight=null,d.viewportHeight=x(),d.viewportWidth=C();var T,P,M,L,I,j;i.prototype={on:function(e,t,n){switch(!0){case e===g&&!this.isInViewport&&this.isAboveViewport:case e===v&&this.isInViewport:case e===h&&this.isFullyInViewport:case e===p&&this.isAboveViewport&&!this.isInViewport:case e===m&&this.isAboveViewport:case e===b&&this.isCanPreload:case e===w&&this.isCanUnload:if(t.call(this,M),n)return}if(!this.callbacks[e])throw new Error("Tried to add a scroll monitor listener of type "+e+". Your options are: "+E.join(", "));this.callbacks[e].push({callback:t,isOne:n||!1})},off:function(e,t){if(!this.callbacks[e])throw new Error("Tried to remove a scroll monitor listener of type "+e+". Your options are: "+E.join(", "));for(var n,o=0;n=this.callbacks[e][o];o++)if(n.callback===t){this.callbacks[e].splice(o,1);break}},one:function(e,t){this.on(e,t,!0)},recalculateSize:function(){this.height=this.watchItem.offsetHeight+this.offsets.top+this.offsets.bottom,this.bottom=this.top+this.height},update:function(){this.isAboveViewport=this.top<d.viewportTop,this.isBelowViewport=this.bottom>d.viewportBottom,this.isInViewport=this.top<=d.viewportBottom&&this.bottom>=d.viewportTop&&this.left<=d.viewportRight&&this.right>=d.viewportLeft,this.isFullyInViewport=this.top>=d.viewportTop&&this.bottom<=d.viewportBottom&&this.left>=d.viewportLeft&&this.right<=d.viewportRight||this.isAboveViewport&&this.isBelowViewport,this.isCanPreload=this.top-a.default.preloadoffset<=d.viewportBottom&&this.bottom+a.default.preloadoffset>=d.viewportTop,this.isCanUnload=!this.isCanPreload},destroy:function(){var e=f.indexOf(this),t=this;f.splice(e,1);for(var n=0,o=E.length;n<o;n++)t.callbacks[E[n]].length=0},lock:function(){this.locked=!0},unlock:function(){this.locked=!1}};for(var R=0,V=E.length;R<V;R++){var D=E[R];i.prototype[D]=function(e){return function(t,n){this.on.call(this,e,t,n)}}(D)}if(l)try{e()}catch(t){try{window.$(e)}catch(e){throw new Error("If you must put scrollMonitor in the <head>, you must use jQuery.")}}if(l){if(window.addEventListener){var N=!1;window.addEventListener("scroll",function(e){N||window.requestAnimationFrame(function(){r(e),N=!1}),N=!0},!0),window.addEventListener("resize",n)}else window.attachEvent("onscroll",r),window.attachEvent("onresize",n);a.default.proactiveload&&setInterval(function(){d.update(),r()},200)}return d.beget=d.create=function(e,t){"string"==typeof e?e=document.querySelector(e):e&&e.length>0&&(e=e[0]);var n=new i(e,t);return f.push(n),n.update(),n},d.update=function(){M=null,e(),o()},d.recalculateLocations=function(){d.documentHeight=0,d.update()},d.version=this.version,d}},{key:"reFactory",value:function(){s.logger.warn("ScrollMonitor create error, reFactory method called"),window.scrollMonitor=this.factory()}}]),e}();n.scrollMonitor=new l},{"../../../config/globalConfig":37,"./../utils/logger":54}],51:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.ls=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("../utils/logger"),a=function(){function e(){o(this,e),this.isLoacalStorageAvailable=!0;try{var t="__storage_test__";localStorage.setItem(t,t),localStorage.removeItem(t)}catch(e){this.isLoacalStorageAvailable=!1,r.logger.warn("LocalStorage is not available")}}return i(e,[{key:"disableLocalStorage",value:function(){this.isLoacalStorageAvailable&&(this.remove("vx_computed"),this.remove("vx_last_returned"),this.remove("vx_parentVideos"),this.remove("vx_recommended"),this.remove("vx_urlInfo"),this.remove("vx_version"),this.remove("vx_viewed")),this.isLoacalStorageAvailable=!1}},{key:"get",value:function(e){if(!this.isLoacalStorageAvailable)return r.logger.warn("LocalStorage is not available"),!1;r.logger.debug("Getting "+e+" from local storage");var t=localStorage.getItem(e);try{t=JSON.parse(t)||!1}catch(e){t=!1}return t}},{key:"set",value:function(e,t){if(!this.isLoacalStorageAvailable)return r.logger.warn("LocalStorage is not available"),!1;r.logger.debug("Saving "+e+" to local storage");try{localStorage.setItem(e,JSON.stringify(t))}catch(e){r.logger.error(e),r.logger.error("Can't save to local storage. Maybe it's full.")}return e}},{key:"remove",value:function(e){return this.isLoacalStorageAvailable?(r.logger.debug("Removing "+e+" from local storage"),localStorage.removeItem(e),e):(r.logger.warn("LocalStorage is not available"),!1)}}]),e}();n.ls=new a},{"../utils/logger":54}],52:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.localStorageUpdater=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("../../../config/privateConfig"),a=function(e){return e&&e.__esModule?e:{default:e}}(r),s=e("./localStorage"),l=e("../utils/logger"),u=function(){function e(){o(this,e)}return i(e,[{key:"validateLocalStorage",value:function(){return!!this.isLocalStorageUpToDate()||(l.logger.log("Version hash mismatch, checking LocalStorage integrity"),this.updateVxComputed()&&this.updateVxRecommended()&&this.updateVxViewed()&&this.updateVxVersion()&&this.updateVxUrlInfo())}},{key:"updateVxComputed",value:function(){var e=s.ls.get("vx_computed")||{};l.logger.info("Validating vx_computed");try{Object.keys(e).forEach(function(t){if(!Array.isArray(e[t]))throw"nope";if("number"!=typeof e[t][0]||"number"!=typeof e[t][1]||1!==e[t][2].length)throw"nope"})}catch(e){l.logger.warn('Can\'t determine structure for "vx_computed" resenting value'),s.ls.set("vx_computed",{})}finally{return!0}}},{key:"updateVxRecommended",value:function(){var e=s.ls.get("vx_recommended")||{};l.logger.info("Validating vx_recommended");try{Object.keys(e).forEach(function(t){if("number"==typeof e[t][0]&&"number"==typeof e[t][1])return!0;throw"nope"})}catch(e){l.logger.warn('Can\'t determine structure for "vx_recommended" resenting value'),s.ls.set("vx_recommended",{})}finally{return!0}}},{key:"updateVxViewed",value:function(){var e=s.ls.get("vx_viewed")||{};l.logger.info("Validating vx_viewed");try{e.forEach(function(e){if("string"==typeof e)return!0;throw"nope"})}catch(e){l.logger.warn('Can\'t determine structure for "vx_viewed" resenting value'),s.ls.set("vx_viewed",[])}finally{return!0}}},{key:"updateVxUrlInfo",value:function(){var e=s.ls.get("vx_urlInfo")||{};try{Object.keys(e).forEach(function(t){if(void 0===e[t].url||void 0===e[t].guid)throw"nope"})}catch(e){l.logger.warn('Can\'t determine structure for "vx_urlInfo" resenting value'),s.ls.set("vx_urlInfo",{}),s.ls.set("vx_computed",{})}finally{return!0}}},{key:"isLocalStorageUpToDate",value:function(){return(s.ls.get("vx_version")||"")===this.hashString(a.default.version)}},{key:"hashString",value:function(e){var t=0,n=void 0,o=void 0;if(0===e.length)return t;for(n=0;n<e.length;n++)o=e.charCodeAt(n),t=(t<<5)-t+o,t|=0;return t}},{key:"updateVxVersion",value:function(){return s.ls.set("vx_version",this.hashString(a.default.version)),!0}}]),e}();n.localStorageUpdater=new u},{"../../../config/privateConfig":38,"../utils/logger":54,"./localStorage":51}],53:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.ss=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("../utils/logger"),a=function(){function e(){o(this,e),this.isSessionStorageAvailable=!0;try{var t="__storage_test__";sessionStorage.setItem(t,t),sessionStorage.removeItem(t)}catch(e){this.isSessionStorageAvailable=!1,r.logger.warn("SessionStorage is not available")}}return i(e,[{key:"disableSessionStorage",value:function(){this.isSessionStorageAvailable&&this.remove("vx_lastBatchRecommended"),this.isSessionStorageAvailable=!1}},{key:"get",value:function(e){if(!this.isSessionStorageAvailable)return r.logger.warn("SessionStorage is not available"),!1;r.logger.debug("Getting "+e+" from local storage");var t=sessionStorage.getItem(e);try{t=JSON.parse(t)||!1}catch(e){t=!1}return t}},{key:"set",value:function(e,t){if(!this.isSessionStorageAvailable)return r.logger.warn("SessionStorage is not available"),!1;r.logger.debug("Saving "+e+" to local storage");try{sessionStorage.setItem(e,JSON.stringify(t))}catch(e){r.logger.error(e),r.logger.error("Can't save to session storage. Maybe it's full.")}return!0}},{key:"remove",value:function(e){return this.isSessionStorageAvailable?(r.logger.debug("Removing "+e+" from local storage"),sessionStorage.removeItem(e),!0):(r.logger.warn("SessionStorage is not available"),!1)}}]),e}();n.ss=new a},{"../utils/logger":54}],54:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.logger=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("../../../config/globalConfig"),a=function(e){return e&&e.__esModule?e:{default:e}}(r),s=function(){function e(){o(this,e),this.info("Logger Enabled")}return i(e,[{key:"debug",value:function(e){a.default.iframed&&(e="[IFRAME] "+e),!a.default.debug||console.debug(e)}},{key:"log",value:function(e){a.default.iframed&&(e="[IFRAME] "+e),!a.default.debug||console.log(e)}},{key:"info",value:function(e){a.default.iframed&&(e="[IFRAME] "+e),!a.default.debug||console.info(e)}},{key:"warn",value:function(e){a.default.iframed&&(e="[IFRAME] "+e),!a.default.debug||console.warn(e)}},{key:"error",value:function(e){a.default.iframed&&(e="[IFRAME] "+e),!a.default.debug||console.error(e)}},{key:"timeStart",value:function(e){a.default.iframed&&(e="[IFRAME] "+e),!a.default.debug||console.time(e)}},{key:"timeStop",value:function(e){a.default.iframed&&(e="[IFRAME] "+e),!a.default.debug||console.timeEnd(e)}}]),e}();n.logger=new s},{"../../../config/globalConfig":37}],55:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./helpers/utils/logger"),a=e("./../config/globalConfig"),s=function(e){return e&&e.__esModule?e:{default:e}}(a),l=function(){function e(t){o(this,e),this.querySelector=t,this.config={},this.isvertical=!1,this.width=document.querySelector(t).offsetWidth,this.height=document.querySelector(t).offsetHeight,this.min_elemwidth=s.default.minelemwidth,this.min_elemheight=s.default.minelemheight,this.min_spacing=s.default.minelemspacing;var n=document.createElement("style"),i=this;n.type="text/css",n.innerHTML=".vx_rec_main {width:100%; height: 100%; display:block; overflow:hidden; }",n.innerHTML+=".vx_rec { height: 100%; width: 100%; float:left;overflow:hidden; padding:0px; align:center;}",n.innerHTML+=".vx_rec a{ text-decoration:none; display:block; margin:0px; padding:0px;}",n.innerHTML+=".vx_rec h2{ font-size:1em; line-height:1.2em; font-family: proxima_nova,Helvetica,Arial,sans-serif;  margin:0px; padding:0px; font-weight:300; color:#666;}",n.innerHTML+=".vx_rec h2:hover,h2:active, h2:focus{ color:#444;}",document.body.appendChild(n),window.addEventListener("resize",function(){i.resizeElements()})}return i(e,[{key:"insertRecommendations",value:function(e){var t=this,n=document.createElement("div"),o=document.createElement("a"),i=document.createElement("div"),a=document.createElement("div"),s=document.createElement("img"),l=document.createElement("h2"),u=document.createElement("a");n.className="vx_rec_main",i.className="vx_rec",s.src="",o.appendChild(s),a.appendChild(o),i.appendChild(a),u.appendChild(l),i.appendChild(u),r.logger.debug("Got "+e.length+" to show thumbnails"),e.forEach(function(e){var o=i.cloneNode(!0),a=o.getElementsByTagName("a")[0],s=o.getElementsByTagName("a")[1],l=o.getElementsByTagName("h2")[0],u=o.getElementsByTagName("img")[0],c=e.title,d=e.thumbnail,f=e.url;d&&-1===d.search(/(^\w+:|^)\/\//)&&(d="//"+d),f&&-1===f.search(/(^\w+:|^)\/\//)&&(f="//"+f),f&&(a.href=f,s.href=f),u.onerror=function(){r.logger.warn("Can't load default recommendation thumbnail, trying gallery fallback."),a.className+=" vilynx_noimage",u.style.visibility="hidden"},d&&(u.src=d),l.innerHTML=c,t.prevHeight=parseInt(window.getComputedStyle(document.querySelector(t.querySelector)).height,10),t.prevWidth=parseInt(window.getComputedStyle(document.querySelector(t.querySelector)).width,10),n.appendChild(o)}),document.querySelector(this.querySelector).appendChild(n),this.resizeElements()}},{key:"resizeElements",value:function(){var e=this;this.width=parseInt(window.getComputedStyle(document.querySelector(this.querySelector)).width,10),this.height=parseInt(window.getComputedStyle(document.querySelector(this.querySelector)).height,10),this.isvertical=!(this.width>this.height);var t=document.querySelector(this.querySelector).getElementsByClassName("vx_rec"),n=this;[].forEach.call(t,function(t,o){if(n.isvertical){t.style.width=n.width+"px";var i=parseInt(window.getComputedStyle(document.querySelector(e.querySelector).getElementsByTagName("h2")[0]).height,10),r=Math.floor((n.height+n.min_spacing)/(n.min_elemheight+n.min_spacing)),a=Math.floor((n.height+n.min_spacing)/r-n.min_spacing),s=Math.floor((n.height-r*a)/(r-1)),l=a-i;t.style.height=a+"px",0!==e.prevWidth&&(t.style.width=n.width+"px"),t.getElementsByTagName("img")[0].style.height=l+"px",t.getElementsByTagName("a")[0].style.height=l+"px",t.getElementsByTagName("img")[0].style.width="100%",t.style.margin="0px",0!==o&&(t.style.marginTop=s+"px")}else{var u=Math.floor((n.width+n.min_spacing)/(n.min_elemwidth+n.min_spacing)),c=Math.floor((n.width+n.min_spacing)/u-n.min_spacing),d=Math.floor((n.width-u*c)/(u-1));t.style.width=c+"px",0!==e.prevHeight&&(t.style.height=n.height+"px"),t.getElementsByTagName("img")[0].style.width=Math.floor(n.width/u)+"px",t.getElementsByTagName("img")[0].style.height=.5625*n.width/u+"px",t.getElementsByTagName("a")[0].style.height="100%",t.style.margin="0px",0!==o&&(t.style.marginLeft=d+"px")}}),this.prevHeight=parseInt(window.getComputedStyle(document.querySelector(this.querySelector)).height,10),this.prevWidth=parseInt(window.getComputedStyle(document.querySelector(this.querySelector)).width,10)}}]),e}();n.default=l},{"./../config/globalConfig":37,"./helpers/utils/logger":54}],56:[function(e,t,n){"use strict";"document"in self&&("classList"in document.createElement("_")?function(){var e=document.createElement("_");if(e.classList.add("c1","c2"),!e.classList.contains("c2")){var t=function(e){var t=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(e){var n,o=arguments.length;for(n=0;n<o;n++)e=arguments[n],t.call(this,e)}};t("add"),t("remove")}if(e.classList.toggle("c3",!1),e.classList.contains("c3")){var n=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(e,t){return 1 in arguments&&!this.contains(e)==!t?t:n.call(this,e)}}e=null}():function(e){if("Element"in e){var t=e.Element.prototype,n=Object,o=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},i=Array.prototype.indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},r=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},a=function(e,t){if(""===t)throw new r("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new r("INVALID_CHARACTER_ERR","String contains an invalid character");return i.call(e,t)},s=function(e){for(var t=o.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[],i=0,r=n.length;i<r;i++)this.push(n[i]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},l=s.prototype=[],u=function(){return new s(this)};if(r.prototype=Error.prototype,l.item=function(e){return this[e]||null},l.contains=function(e){return e+="",-1!==a(this,e)},l.add=function(){var e,t=arguments,n=0,o=t.length,i=!1;do{e=t[n]+"",-1===a(this,e)&&(this.push(e),i=!0)}while(++n<o);i&&this._updateClassName()},l.remove=function(){var e,t,n=arguments,o=0,i=n.length,r=!1;do{for(e=n[o]+"",t=a(this,e);-1!==t;)this.splice(t,1),r=!0,t=a(this,e)}while(++o<i);r&&this._updateClassName()},l.toggle=function(e,t){e+="";var n=this.contains(e),o=n?!0!==t&&"remove":!1!==t&&"add";return o&&this[o](e),!0===t||!1===t?t:!n},l.toString=function(){return this.join(" ")},n.defineProperty){var c={get:u,enumerable:!0,configurable:!0};try{n.defineProperty(t,"classList",c)}catch(e){-2146823252===e.number&&(c.enumerable=!1,n.defineProperty(t,"classList",c))}
}else n.prototype.__defineGetter__&&t.__defineGetter__("classList",u)}}(self))},{}],57:[function(e,t,n){"use strict";!function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}if("function"==typeof window.CustomEvent)return!1;e.prototype=window.Event.prototype,window.CustomEvent=e}()},{}],58:[function(e,t,n){"use strict";!function(){function e(e){S.push(e),E||(E=!0,_(n))}function t(e){return window.ShadowDOMPolyfill&&window.ShadowDOMPolyfill.wrapIfNeeded(e)||e}function n(){E=!1;var e=S;S=[],e.sort(function(e,t){return e.uid_-t.uid_});var t=!1;e.forEach(function(e){var n=e.takeRecords();o(e),n.length&&(e.callback_(n,e),t=!0)}),t&&n()}function o(e){e.nodes_.forEach(function(t){var n=y.get(t);n&&n.forEach(function(t){t.observer===e&&t.removeTransientObservers()})})}function i(e,t){for(var n=e;n;n=n.parentNode){var o=y.get(n);if(o)for(var i=0;i<o.length;i++){var r=o[i],a=r.options;if(n===e||a.subtree){var s=t(a);s&&r.enqueue(s)}}}}function r(e){this.callback_=e,this.nodes_=[],this.records_=[],this.uid_=++x}function a(e,t){this.type=e,this.target=t,this.addedNodes=[],this.removedNodes=[],this.previousSibling=null,this.nextSibling=null,this.attributeName=null,this.attributeNamespace=null,this.oldValue=null}function s(e){var t=new a(e.type,e.target);return t.addedNodes=e.addedNodes.slice(),t.removedNodes=e.removedNodes.slice(),t.previousSibling=e.previousSibling,t.nextSibling=e.nextSibling,t.attributeName=e.attributeName,t.attributeNamespace=e.attributeNamespace,t.oldValue=e.oldValue,t}function l(e,t){return C=new a(e,t)}function u(e){return k||(k=s(C),k.oldValue=e,k)}function c(){C=k=void 0}function d(e){return e===k||e===C}function f(e,t){return e===t?e:k&&d(e)?k:null}function g(e,t,n){this.observer=e,this.target=t,this.options=n,this.transientObservedNodes=[]}var v=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,h=window.WeakMap;if(void 0===h){var p=Object.defineProperty,m=Date.now()%1e9;h=function(){this.name="__st"+(1e9*Math.random()>>>0)+m+++"__"},h.prototype={set:function(e,t){var n=e[this.name];return n&&n[0]===e?n[1]=t:p(e,this.name,{value:[e,t],writable:!0}),this},get:function(e){var t;return(t=e[this.name])&&t[0]===e?t[1]:void 0},delete:function(e){var t=e[this.name];if(!t)return!1;var n=t[0]===e;return t[0]=t[1]=void 0,n},has:function(e){var t=e[this.name];return!!t&&t[0]===e}}}var y=new h,_=window.msSetImmediate;if(!_){var b=[],w=String(Math.random());window.addEventListener("message",function(e){if(e.data===w){var t=b;b=[],t.forEach(function(e){e()})}}),_=function(e){b.push(e),window.postMessage(w,"*")}}var E=!1,S=[],x=0;r.prototype={observe:function(e,n){if(e=t(e),!n.childList&&!n.attributes&&!n.characterData||n.attributeOldValue&&!n.attributes||n.attributeFilter&&n.attributeFilter.length&&!n.attributes||n.characterDataOldValue&&!n.characterData)throw new SyntaxError;var o=y.get(e);o||y.set(e,o=[]);for(var i,r=0;r<o.length;r++)if(o[r].observer===this){i=o[r],i.removeListeners(),i.options=n;break}i||(i=new g(this,e,n),o.push(i),this.nodes_.push(e)),i.addListeners()},disconnect:function(){this.nodes_.forEach(function(e){for(var t=y.get(e),n=0;n<t.length;n++){var o=t[n];if(o.observer===this){o.removeListeners(),t.splice(n,1);break}}},this),this.records_=[]},takeRecords:function(){var e=this.records_;return this.records_=[],e}};var C,k;g.prototype={enqueue:function(t){var n=this.observer.records_,o=n.length;if(n.length>0){var i=n[o-1],r=f(i,t);if(r)return void(n[o-1]=r)}else e(this.observer);n[o]=t},addListeners:function(){this.addListeners_(this.target)},addListeners_:function(e){var t=this.options;t.attributes&&e.addEventListener("DOMAttrModified",this,!0),t.characterData&&e.addEventListener("DOMCharacterDataModified",this,!0),t.childList&&e.addEventListener("DOMNodeInserted",this,!0),(t.childList||t.subtree)&&e.addEventListener("DOMNodeRemoved",this,!0)},removeListeners:function(){this.removeListeners_(this.target)},removeListeners_:function(e){var t=this.options;t.attributes&&e.removeEventListener("DOMAttrModified",this,!0),t.characterData&&e.removeEventListener("DOMCharacterDataModified",this,!0),t.childList&&e.removeEventListener("DOMNodeInserted",this,!0),(t.childList||t.subtree)&&e.removeEventListener("DOMNodeRemoved",this,!0)},addTransientObserver:function(e){if(e!==this.target){this.addListeners_(e),this.transientObservedNodes.push(e);var t=y.get(e);t||y.set(e,t=[]),t.push(this)}},removeTransientObservers:function(){var e=this.transientObservedNodes;this.transientObservedNodes=[],e.forEach(function(e){this.removeListeners_(e);for(var t=y.get(e),n=0;n<t.length;n++)if(t[n]===this){t.splice(n,1);break}},this)},handleEvent:function(e){switch(e.stopImmediatePropagation(),e.type){case"DOMAttrModified":var t=e.attrName,n=e.relatedNode.namespaceURI,o=e.target,r=new l("attributes",o);r.attributeName=t,r.attributeNamespace=n;var a=null;"undefined"!=typeof MutationEvent&&e.attrChange===MutationEvent.ADDITION||(a=e.prevValue),i(o,function(e){if(e.attributes&&(!e.attributeFilter||!e.attributeFilter.length||-1!==e.attributeFilter.indexOf(t)||-1!==e.attributeFilter.indexOf(n)))return e.attributeOldValue?u(a):r});break;case"DOMCharacterDataModified":var o=e.target,r=l("characterData",o),a=e.prevValue;i(o,function(e){if(e.characterData)return e.characterDataOldValue?u(a):r});break;case"DOMNodeRemoved":this.addTransientObserver(e.target);case"DOMNodeInserted":var s,d,o=e.relatedNode,f=e.target;"DOMNodeInserted"===e.type?(s=[f],d=[]):(s=[],d=[f]);var g=f.previousSibling,v=f.nextSibling,r=l("childList",o);r.addedNodes=s,r.removedNodes=d,r.previousSibling=g,r.nextSibling=v,i(o,function(e){if(e.childList)return r})}c()}},v||(window.MutationObserver=r)}()},{}],59:[function(e,t,n){"use strict";"path"in Event.prototype||Object.defineProperty(Event.prototype,"path",{get:function(){for(var e=[],t=this.target;t;)e.push(t),t=t.parentElement;return-1===e.indexOf(window)&&-1===e.indexOf(document)&&e.push(document),-1===e.indexOf(window)&&e.push(window),e}})},{}]},{},[39]);