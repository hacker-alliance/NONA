var urlParams;(window.onpopstate=function(){function e(e){return decodeURIComponent(e.replace(i," "))}var t,i=/\+/g,a=/([^&=]+)=?([^&]*)/g,r=window.location.search.substring(1);for(urlParams={};t=a.exec(r);)urlParams[e(t[1])]=e(t[2])})(),jQuery.expr[":"].icontains=jQuery.expr.createPseudo(function(t){return function(e){return 0<=jQuery(e).text().toUpperCase().indexOf(t.toUpperCase())}}),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t}),function(e){if(e("html").hasClass("earth-explore")){var t=e("footer").height(),i=e(window).height()-2*t;e(".component-explore-grid").css({"min-height":i,transition:"min-height 0.2s ease-in"})}}(jQuery),function(g){g.exploreGrid=function(e,t){var o=this;o.$el=g(e),o.el=e;var i=g("#tile-template").html(),a=g("#filter-tile-template").html(),r=Handlebars.compile(i),l=Handlebars.compile(a),s=RELATIVE_ROOT+"components/explore_grid/json",n=332,c=1.5;function f(e,t){var i=new RegExp("^.*(.{"+t.length+"})$");return parseInt(e,10).toString(36).replace(/^/,t).replace(i,"$1")}o.filter={all:!0,page:1,tags:[]},o.$el.data("exploreGrid",o),o.init=function(){o.options=g.extend({},g.exploreGrid.defaultOptions,t),"filter"==o.$el.data("state")&&(o.filter.all=!1,o.$el.data("region")&&(o.filter.region=o.$el.data("region")),o.$el.data("habitat")&&(o.filter.habitat=o.$el.data("habitat")),o.$el.data("show")&&(o.filter.show=o.$el.data("show"))),o.$el.data("not")&&(o.filter.not=o.$el.data("not")),o.$el.data("perPage")&&(o.filter.perPage=o.$el.data("perPage")),console.log(o.$el.data(),"data",o.filter.perPage),console.log(o.filter,4),o.fetchTiles(o.filter),o.$el.isotope({itemSelector:".grid-item",layoutMode:"packery",packery:{columnWidth:".grid-sizer",gutter:".gutter-sizer"},percentPosition:!0},function(){g(".tint-text").ellipsis()})},o.imageURL=function(e,t,i){t=void 0!==t?t:0,i=void 0!==i?i:0;return imageUrl=ASSET_MANAGER+"/i/"+f(e,"00000")+f(t,"000")+f(i,"000")+"000"},o.videoURL=function(e){return videoURL=ASSET_MANAGER+"/v/"+f(e,"00000")},o.filterGroup=function(e){if(g(".filter-all, .filter-group").removeClass("active"),g(e).addClass("active"),g(".sub-tag").removeClass("sub-tag-active"),g(".search-tag").removeClass("search-tag-active"),g(".sub-tag").removeClass("show-me-filter-options"),g(".filter-choice-active").each(function(){g(this).removeClass("filter-choice-active")}),g(".filter-choices").html(""),g(e).next(".sub-tag").addClass("sub-tag-active"),g(e).next(".search-tag").addClass("search-tag-active"),"all"==g(e).data("filter"))o.resetSearch(),g(".sub-tag").removeClass("show-me-filter-options");else g(e).attr("data-filter-group");o.filter={all:!0,page:o.filter.page,tags:[]},console.log(o.filter,"filterGroup"),o.filterTiles()},o.filterSubTags=function(e){if(o.$el.data("filterable")){o.filter={page:o.filter.page,all:!1},console.log(o.filter,"filterSubTags",g(".sub-tag").hasClass("show-me-filter-options"));var t=g(e).closest(".group").find("*[data-filter-group]").data("filter-group").toLowerCase(),i=g(e).data("filter").toLowerCase();g(e).hasClass("filter-choice-active")?(g(".filter-choice[data-filter]").remove(),o.filter.all=!0):(g(".filter-choice[data-filter]").not('.filter-choice[data-filter="'+i+'"]').remove(),g(".filter-choices").append('<a href="#" class="filter-choice" data-filter="'+g(e).data("filter")+'">'+g(e).data("filter")+"</a>"),o.filter.tags=i,o.filter.hasOwnProperty(t)||(o.filter[t]=i)),g(".filter-choice-active").not(e).each(function(){g(this).removeClass("filter-choice-active")}),g(e).toggleClass("filter-choice-active"),o.filterTiles()}},o.filterTiles=function(){if(g.isMobile.generic&&(o.filter.tags||o.filter.region)&&g(".mobile-filter").trigger("click"),console.log("filterTiles",o.filter),jselector="",o.filter.all)jselector="*";else{var r=["all","page"];g.each(o.filter,function(e,t){if(-1===r.indexOf(e))if(t.constructor===Array)for(var i=0;i<t.length;i++){var a=t[i].toLowerCase();jselector+="*[data-"+e+'*="'+a+'"],'}else{a=t.toLowerCase();jselector+="*[data-"+e+'*="'+a+'"],'}}),tagstring="*[data-by-tag*='"+o.filter.tags.toLowerCase()+"']:not('.filter-tile')",jselector+=tagstring,jselector=jselector.replace(/,\s*$/,"")}o.filter.search&&(jselector+=':icontains("'+o.filter.search+'")'),o.$el.isotope({filter:jselector}),o.$el.data("isotope").filteredItems.length?(o.fetchTiles(o.filter,!1),g(".no-results").hide()):o.fetchTiles(o.filter,!0)},o.fetchTiles=function(i,a){i=void 0!==i?i:{};var r="";i=Object.assign(i,urlParams),console.log("filters",i),g.each(i,function(e,t){"object"==typeof t&&(i[e]=t.join())}),g.get(s,i).done(function(e){if(null!=e.filters){var t=e.filters.length;e.entries.length}if(null!=e.entries&&0!=e.entries.length){g.each(e.entries,function(e,t){"explore-grid-rows"==t.section?r+=o.createFilterTile(t):0==g("#tile"+t.id).length&&o.$el.data("not")!=t.id&&(r+=o.createTile(t))});var i=g(r);o.$el.isotope().append(i).isotope("appended",i).isotope("layout"),o.initNewTiles(),e.more&&0<e.more?o.showPagination():o.hidePagination()}else a&&(g(".no-results").show(),o.hidePagination());0==e.count&&o.hidePagination(),o.$el.data("isotope").filteredItems.length||(g(".no-results").show(),o.hidePagination()),g(".explore-grid .explore-tile .blog-text-float h1").each(function(){var e=g(this).text().trim();if(42<=e.length){var t=g.trim(e).substring(0,62).split(" ").slice(0,-1).join(" ")+"...";g(this).text(t)}})})},o.showPagination=function(e){if(0==o.$el.find("a.load-more").length){var t=g('<a class="load-more">Load More</a>');o.$el.append(t)}else t=o.$el.find("a.load-more");t.show()},o.hidePagination=function(e){o.$el.find("a.load-more").hide()},o.initNewTiles=function(){o.$el.find(".explore-tile:not(.initiated)").each(function(){$tile=g(this),$tile.hasClass("mode--video")&&$tile.videoTile(),g(this).addClass("initiated")}),o.$el.imagesLoaded().progress(function(){o.$el.isotope("layout"),g(".tint-text").ellipsis()}),Modernizr.webp&&5.6<PHP_VERSION&&WEBP_ACTIVE&&o.$el.find(".lozad").each(function(){if($this=g(this),$this.data("background-image")){var e=g(this).data("background-image");e=e.replace("/i/","/iv2/"),$this.attr("data-background-image",e)}}),observer.observe()},o.createTile=function(e){if("blogs"==e.origin?(e.size="2x1",e.page=RELATIVE_ROOT+"/blog/?article="+e.path):"quiz-articles"==e.origin?(e.size="2x1",e.page=RELATIVE_ROOT+"/quizzes/?article="+e.path):e.page&&!e.page.startsWith("http")&&(e.page=RELATIVE_ROOT+e.page),e.page&&e.page.startsWith("http")&&(e.external=!0),e.page&&!e.page.startsWith("http")&&(e.page=e.page.replace("//","/")),null!=e.image&&"social-tint-tiles"!=e.origin){var t=e.size.split("x")[0]*n*c,i=e.size.split("x")[1]*n*c;e.image=o.imageURL(e.image,t,i)}return null!=e.video&&(e.video=o.videoURL(e.video)),r(e)},o.createFilterTile=function(e){if(null!=e.image){var t=e.size.split("x")[0]*n*c,i=e.size.split("x")[1]*n*c;e.image=o.imageURL(e.image,t,i)}return l(e)},o.resetSearch=function(){g(".sub-tag.search-tag").slideUp("slow",function(){g(this).find('input[name="search"]').val(""),delete o.filter.search,o.filterTiles(o.filter),g("nav.tag-filters ul.main-tag li a.search").removeClass("active")})},o.init()},g.exploreGrid.defaultOptions={radius:"20px"},g.fn.exploreGrid=function(e){return this.each(function(){new g.exploreGrid(this,e);var a=g(this).data("exploreGrid");a.$el.on("filter-tiles",function(e,t){a.filterTiles(t)}),a.$el.on("click","a.load-more",function(e,t){a.filter.page=a.filter.page+1,console.log(a.filter,3),a.fetchTiles({all:!0,page:a.filter.page})}),a.$el.on("click",".filter-tile a",function(e){e.preventDefault();var t=g(this).parent(".filter-tile").data("by-tag").toLowerCase(),i=g(this).parent(".filter-tile").data("by-category").toLowerCase();g('.sub-tag-item[data-filter="'+t+'"]').length?(g('.sub-tag-item[data-filter="'+t+'"]').parents(".group").find("a.filter-group").trigger("click"),g('.sub-tag-item[data-filter="'+t+'"]').trigger("click")):(a.filter={all:!1,page:a.filter.page,tags:t},a.filter[i]=t,a.filterTiles())}),g(".filter-group").on("click",function(e){e.preventDefault(),a.filterGroup(this),g("body").find(".show-me-filter-options").removeClass("show-me-filter-options");var t=g(".sub-tag-active").height()/10+3.5;t<4?g(".explore-header").css({"margin-bottom":"4em",transition:"margin-bottom 0.1s ease-in"}):10<t&&t<13&&g(this).hasClass("search")||(12<t?g(".explore-header").css({"margin-bottom":"13em",transition:"margin-bottom 0.1s ease-in"}):g(".explore-header").css({"margin-bottom":"10em",transition:"margin-bottom 0.1s ease-in"}))}),g(".tag-filters .search").on("click",function(){g(this).hasClass("active")?a.resetSearch():(g(".sub-tag.search-tag").slideDown("slow"),g(this).addClass("active"))}),g("form.explore-search").on("submit",function(e){e.preventDefault();var t=g(this).find('input[name="search"]').val();return a.filter.search=t,a.filterTiles(),console.log("here"),!1}).on("keyup",".search-field input",function(){var e=g(this).parent().find("a.reset");0<g(this).val().length?e.show():e.hide()}).on("click",".search-field .reset",function(){a.resetSearch()}),g(".sub-tag-item").on("click",function(e){e.preventDefault(),a.filterSubTags(this)})})},g(".filter-choices").on("click",">.filter-choice",function(e){e.preventDefault(),g(this).fadeOut(),g('a[data-filter="'+g(this).data("filter")+'"]').trigger("click")}),g(".mobile-filter").on("click",function(){g(this).parent("ul").toggleClass("show-me-filter-options");var e=g(".sub-tag-active").height()/10+3.5;14<e?g(".explore-header").css({"margin-bottom":e+"rem",transition:"margin-bottom 0.1s ease-in"}):e<4?g(".explore-header").css({"margin-bottom":"4em",transition:"margin-bottom 0.1s ease-in"}):9<e?g(".explore-header").css({"margin-bottom":"13em",transition:"margin-bottom 0.1s ease-in"}):g(".explore-header").css({"margin-bottom":"10em",transition:"margin-bottom 0.1s ease-in"})}),g(window).on("resize",function(){if(1026<g(window).width()){g(".sub-tag-active").removeClass("show-me-filter-options");var e=g(".sub-tag-active").height()/10+3.5;14<e?g(".explore-header").css({"margin-bottom":e+"rem",transition:"margin-bottom 0.1s ease-in"}):e<4?g(".explore-header").css({"margin-bottom":"4em",transition:"margin-bottom 0.1s ease-in"}):10<e&&e<13&&g(this).hasClass("search")||(12<e?g(".explore-header").css({"margin-bottom":"13em",transition:"margin-bottom 0.1s ease-in"}):g(".explore-header").css({"margin-bottom":"10em",transition:"margin-bottom 0.1s ease-in"}))}}),g(window).scroll(function(){1e3<g(window).scrollTop()?g(".return-to-top").addClass("return-to-top-active"):g(".return-to-top").removeClass("return-to-top-active"),Math.floor(g(document).height()-g(document).scrollTop()-g(window).height())<60?g(".return-to-top").addClass("return-to-top-bottom-margin"):g(".return-to-top").removeClass("return-to-top-bottom-margin")}),g(".return-to-top").on("click",function(){return g("html, body").animate({scrollTop:0},"slow"),!1})}(jQuery),$(function(){$(".explore-grid").exploreGrid()});