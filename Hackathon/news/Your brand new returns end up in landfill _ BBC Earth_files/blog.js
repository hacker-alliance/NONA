!function(e){e.blog=function(t,n){var i=this;i.$el=e(t),i.el=t,i.$el.data("blog",i),i.init=function(){i.options=e.extend({},e.blog.defaultOptions,n),i.articles={},i.initWatchers(),i.initCurrentState(),i.options.afterInit(i.$el)},i.initWatchers=function(){window.onpopstate=function(e){}},i.initCurrentState=function(){i.$currentArticle=i.$el.find("> article"),i.$nextLink=i.$el.find("footer > a"),i.$nextHref=i.$nextLink.attr("href"),i.$nextArticle=e(),i.$nextHasLoaded=!1,i.$nextLink.off("click").on("click",function(e){e.preventDefault(),i.displayNext()}),"undefined"!=typeof FB&&FB.XFBML.parse(),i.$currentArticle.find("a.share-btn").sharePalette();var t=i.urlParam("article");i.articles[t]=i.$currentArticle,i.preloadNextArticle()},i.preloadNextArticle=function(){i.$nextHasLoaded=!1,i.$nextLink.addClass("loading");var t=i.urlParam("article",i.$nextHref);void 0!=i.articles[t]?(i.$nextArticle=i.articles[t],i.$nextHasLoaded=!0,i.$nextLink.removeClass("loading").addClass("loaded")):e.get(i.$nextHref).done(function(t){html=e(t.replace(/(<body [^>]*>)/i,"$1<div>").replace(/(<\/body>)/i,"</div>$1")),i.$nextArticle=e("#blog > article",html),i.$nextHasLoaded=!0,i.$nextLink.removeClass("loading").addClass("loaded")})},i.displayNext=function(){i.options.beforeTransition(i.$el),i.$nextLink.off("click"),i.$currentArticle.find("footer").css({display:"none"}),i.$nextArticle.css({height:""}),i.$nextArticle.find("footer").css({display:""}),i.$el.append(i.$nextArticle),history.pushState("","",i.$nextHref),e("html, body").animate({scrollTop:0},1100),i.$currentArticle.css({height:""}).animate({height:0},1e3,function(){i.$currentArticle.remove(),i.initCurrentState(),i.options.afterTransition(i.$el)})},i.displayArticle=function(e){void 0!=i.articles[e]&&(i.$nextArticle=i.articles[e],i.$nextHasLoaded=!0,i.displayNext())},i.urlParam=function(e,t){t="undefined"!=typeof t?t:window.location.href,e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=n.exec(t);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))},i.init()},e.blog.defaultOptions={afterInit:function(e){},beforeTransition:function(e){},afterTransition:function(e){}},e.fn.blog=function(t){return this.each(function(){new e.blog(this,t);e(this).data("blog")})}}(jQuery);